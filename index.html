<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Panel dividido + Portrait Fix</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin=""/>
<style>
	:root{
		--sidebar-size: 15%;
	}

	html,body{
		height:100%;
		margin:0;
		font-family:Inter, system-ui, Arial, sans-serif;
		background: linear-gradient(270deg, #ff6b6b, #feca57, #48dbfb, #1dd1a1);
		background-size: 800% 800%;
		animation: gradiente 12s ease infinite;
	}

	body{padding: 1%;box-sizing: border-box;}

	@keyframes gradiente {
		0%   { background-position: 0% 50%; }
		50%  { background-position: 100% 50%; }
		100% { background-position: 0% 50%; }
	}

	.app{
		display:flex;
		flex-direction:column;
		height:100%;
		box-sizing:border-box;
	}

	.sidebar{
		background:white;
		border-radius:10px;
		box-shadow:0 6px 18px rgba(15,23,42,0.08);
		display:flex;
		flex-direction:column;
		overflow:hidden;
		max-height:96.5%;
		padding:16px;
		position:relative;
		transition: transform .35s ease;
	}

	.sidebar-inner {
		display:flex;
		flex-direction:column;
		gap: 3%;
		height:100%;
	}

	#sidebar-top {
		position: relative;
		width: 100%;
		height: 30%;
		background: linear-gradient(to bottom, #2ea3d6, #145e7d);
		border-radius: 8px;
		overflow: hidden;
		display: flex;
		justify-content: center;
		align-items: flex-start;
	}

	.sidebar-bottom{
		background: linear-gradient(to bottom, #2ea3d6, #145e7d);
		border-radius:8px;
		padding:12px;
		overflow-y:auto;
		scrollbar-width:thin;
		height: 60%;
		display: flex;
		flex-direction: column-reverse;
		gap: 8px;
		flex:1;
	}

	.boton {
		position: absolute;
		left: 50%;
		transform: translateX(-50%);
		background: rgba(255,255,255,0.2);
		border: 1px solid rgba(255,255,255,0.3);
		color: white;
		border-radius: 6px;
		padding: 8px 20px;
		opacity: 0;
		width: 150px;
		z-index: 4000;
	}

	@keyframes caer {
		0% { transform: translate(-50%, -150%); opacity: 0; }
		100%{ transform: translate(-50%, 0); opacity:1; }
	}

	@keyframes subir {
		0%{ transform: translate(-50%, 0); opacity:1; }
		100%{ transform: translate(-50%, -150%); opacity:0; }
	}

	.boton-fall { animation: caer 1.2s ease-out forwards; }
	.boton-rise { animation: subir 1.1s ease-in forwards; }

	.content{
		flex:1 1 auto;
		min-height:0;
		position: relative;
	}

	#mapa{
		width:100%;
		height:100%;
		border-radius:10px;
		box-shadow:0 6px 18px rgba(15,23,42,0.06) inset;
		overflow:hidden;
	}

	/* Landscape â†’ diseÃ±o original sin cambios */
	@media (orientation: landscape){
		.app{ flex-direction:row; padding:0 !important; gap:0 !important; }
		.sidebar{
			flex:0 0 var(--sidebar-size);
			height:100vh;
			transform:none !important;
		}
	}

	.olas {
		position: absolute;
		width: 200%;
		height: 90%;
		bottom: 0;
		left: -50%;
		background: radial-gradient(circle at 50% 50%, rgba(255,255,255,0.15), rgba(255,255,255,0.05) 60%, transparent 100%);
		animation: moverOlas 6s linear infinite;
		border-radius: 45% 55% 50% 50%;
	}

	@keyframes moverOlas {
		0%   { transform: translateX(0); }
		100% { transform: translateX(-25%); }
	}

	.burbujas {
		position: absolute;
		inset: 0;
		overflow: hidden;
		z-index: 3;
	}

	.burbuja {
		position: absolute;
		bottom: -50px;
		background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.9), rgba(255,255,255,0.3));
		border-radius: 50%;
		opacity: 0.8;
		animation: subirburbujas 2s linear forwards;
	}

	@keyframes subirburbujas {
		0% { transform: translateY(0) scale(0.7); opacity:0.8; }
		100%{ transform: translateY(-120vh) scale(1.1); opacity:0; }
	}

	#BotonMenu {
		position: absolute;
		left: 16px;
		position: absolute;
		top: 8px;
		z-index: 10;
		z-index: 1200;
		width: 44px;
		height: 44px;
		border-radius: 10px;
		background: rgba(255,255,255,0.08);
		backdrop-filter: blur(8px);
		border:1px solid rgba(255,255,255,0.1);
		display:flex;
		align-items:center;
		justify-content:center;
		cursor:pointer;
		animation: pulseBlue 1.7s infinite ease-in-out;
	}

	/* ðŸ”´ Cuando estÃ¡ en X (estado activo) â†’ palpitaciÃ³n roja */
	#BotonMenu.active {
		animation: pulseRed 1.7s infinite ease-in-out;
	}


	/* ====================== */
	/* ðŸ”µ PALPITACIÃ“N AZUL    */
	/* ====================== */
	@keyframes pulseBlue {
		0% {
			transform: scale(1);
			background: linear-gradient(135deg, #0066ff, #009dff);
		}
		50% {
			transform: scale(1.12);
			background: linear-gradient(135deg, #00b7ff, #006dff);
			box-shadow: 0 0 12px rgba(0, 140, 255, 0.6);
		}
		100% {
			transform: scale(1);
			background: linear-gradient(135deg, #0066ff, #009dff);
		}
	}

	/* ====================== */
	/* ðŸ”´ PALPITACIÃ“N ROJA    */
	/* ====================== */
	@keyframes pulseRed {
		0% {
			transform: scale(1);
			background: linear-gradient(135deg, #ff2b2b, #ff4f4f);
		}
		50% {
			transform: scale(1.12);
			background: linear-gradient(135deg, #ff6b6b, #ff1a1a);
			box-shadow: 0 0 12px rgba(255, 50, 50, 0.6);
		}
		100% {
			transform: scale(1);
			background: linear-gradient(135deg, #ff2b2b, #ff4f4f);
		}
	}

	/* Toggle portrait â†’ oculto por defecto */
	#MenuFlotante {
		display:none;
	}

	/* Portrait â†’ mapa 100%, sidebar oculto, botÃ³n flotante visible */
	@media (orientation: portrait){
		#MenuFlotante {
			position: fixed;
			bottom: 20px;
			right: 20px;
			z-index: 2000;
			width: 200px;
			height: 200px;
			border-radius: 50%;
			background: blue;
			backdrop-filter: blur(8px);
			border: 1px solid rgba(255,255,255,0.3);
			display:flex;
			align-items:center;
			justify-content:center;
			font-size: 50px;
			color:white;
			cursor:pointer;
		}

		.sidebar {
			position: fixed;
			bottom: 0;
			left: 0;
			width:100%;
			height:55vh;
			transform: translateY(100%);
			z-index:1500;
		}

		.sidebar.activo {
			transform: translateY(0) !important;
		}

		body.panel-abierto {
			overflow:hidden;
			touch-action:none;
		}
	}
	
	/* ============================
	BOTÃ“N MENU HAMBURGUESA
	============================ */
	#BotonMenu.hamburger-btn {
		position: absolute;
		top: 16px;
		left: 16px;
		width: 46px;
		height: 46px;
		border-radius: 10px;
		border: none;
		cursor: pointer;
		background: #007bff;     /* azul */
		display: flex;
		flex-direction: column;
		justify-content: center;
		align-items: center;
		gap: 6px;
		transition: background 0.3s ease;
		z-index: 1200;
	}

	/* Las barras */
	#BotonMenu.hamburger-btn span {
		width: 26px;
		height: 3px;
		background: white;
		border-radius: 2px;
		transition: transform .3s ease, opacity .22s ease;
	}

	/* Estado ACTIVO = X */
	#BotonMenu.hamburger-btn.active {
		background: #ff2b2b;    /* rojo */
	}

	#BotonMenu.hamburger-btn.active span:nth-child(1) {
		transform: translateY(9px) rotate(45deg);
	}

	#BotonMenu.hamburger-btn.active span:nth-child(2) {
		opacity: 0;
	}

	#BotonMenu.hamburger-btn.active span:nth-child(3) {
		transform: translateY(-9px) rotate(-45deg);
	}
	/* Botones que aparecen en sidebar-bottom */
	.new-btn {
		width: 90%;
		margin: 8px auto;
		padding: 10px;
		background: rgba(255,255,255,0.1);
		border: 1px solid rgba(255,255,255,0.2);
		border-radius: 12px;
		color: white;
		font-size: 15px;
		text-align: center;
		cursor: pointer;
		opacity: 0;
		transform: translateY(-20px);
		animation: fallIn 0.4s forwards ease-out;
	}

	/* AnimaciÃ³n caÃ­da */
	@keyframes fallIn {
		from {
			opacity: 0;
			transform: translateY(-30px) scale(0.9);
		}
		to {
			opacity: 1;
			transform: translateY(0) scale(1);
		}
	}
	
	@keyframes desgranado-suave {
		0% {
			transform: translateY(0) rotate(0deg);
			opacity: 1;
		}
		50% {
			transform: translateY(10px) rotate(-3deg);
			opacity: 0.8;
		}
		80% {
			transform: translateY(20px) rotate(5deg);
			opacity: 0.5;
		}
		100% {
			transform: translateY(40px) rotate(8deg);
			opacity: 0;
		}
	}

	.boton-desgranado-suave {
		animation: desgranado-suave 1s ease forwards;
	}
</style>
</head>
<body>
<!-- BotÃ³n flotante (solo portrait) -->
<div id="MenuFlotante">â‰¡</div>
<div class="app">
	<aside class="sidebar" id="panel">
		<div class="sidebar-inner">
			<div id="sidebar-top">
				<button id="BotonMenu" class="hamburger-btn">
					<span></span>
					<span></span>
					<span></span>
				</button>
			</div>
			<div class="sidebar-bottom" id="sidebarBottom">
				<div id="olas" class="olas"></div>
				<div id="burbujas" class="burbujas"></div>
			</div>
		</div>
	</aside>
	<main class="content">
		<div id="mapa"></div>
	</main>
</div>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
	/* ---------- mapa ---------- */
	const mapa = L.map('mapa', { zoomControl:false }).setView([-34.61, -58.38], 13);
	L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom:19 }).addTo(mapa);

	function refreshMap(){ setTimeout(()=> mapa.invalidateSize(), 250); }

	/* ---------- burbujas ---------- */
	const cont = document.getElementById('burbujas');
	function crearBurbujas() {
		const b = document.createElement('div');
		b.classList.add('burbuja');
		const size = Math.random() * 20 + 10;
		b.style.width = size + 'px';
		b.style.height = size + 'px';
		b.style.left = Math.random() * 100 + '%';
		b.style.animationDuration = (Math.random() * 3 + 2) + 's';
		cont.appendChild(b);
		setTimeout(() => b.remove(), 2500);
	};
	
	setInterval(() => { for (let i=0;i<3;i++) crearBurbujas(); }, 350);

	/* ---------- botones GPS/TRACKING/MARCAR ---------- */
	const BotonMenu = document.getElementById('BotonMenu');
	const sidebarTop = document.getElementById('sidebar-top');
	let abierto = false;

	function accionGPS() {generarBotonesNuevos("GPS")};
	function accionTracking() {generarBotonesNuevos("TRACKING")};
	function accionMarcar() {generarBotonesNuevos("MARCAR")};

	function crearParticulas(x, y, cont) {
		for (let i = 0; i < 5; i++) { // 5 partÃ­culas por botÃ³n
			const p = document.createElement('div');
			p.style.position = 'absolute';
			p.style.width = Math.random()*6 + 4 + 'px';
			p.style.height = p.style.width;
			p.style.background = `hsl(${Math.random()*360}, 80%, 60%)`;
			p.style.borderRadius = '50%';
			p.style.left = x + 'px';
			p.style.top = y + 'px';
			p.style.opacity = 1;
			p.style.pointerEvents = 'none';
			p.style.transform = `translate(0,0)`;
			p.style.transition = 'transform 0.8s ease, opacity 0.8s ease';
			cont.appendChild(p);
			const dx = (Math.random() - 0.5) * 40;
			const dy = Math.random() * 40 + 20;
			setTimeout(() => {
				p.style.transform = `translate(${dx}px, ${dy}px)`;
				p.style.opacity = 0;
			}, 10);
			setTimeout(() => p.remove(), 900);
		};
	};

	BotonMenu.addEventListener('click', () => {
		BotonMenu.classList.toggle("active");
		if (!abierto) crearBotones();
		else subirBotones();
		abierto = !abierto;
		if (!BotonMenu.classList.contains("active")) {
			const cont = document.querySelector(".sidebar-bottom");
			const botones = cont.querySelectorAll("button");
			botones.forEach((btn, i) => {
				const delay = (Math.random() * 0.25).toFixed(2);
				btn.style.animationDelay = delay + "s";
				btn.classList.add("boton-desgranado-suave");
				// Crear partÃ­culas en la posiciÃ³n del botÃ³n
				const rect = btn.getBoundingClientRect();
				const contRect = cont.getBoundingClientRect();
				const x = rect.left - contRect.left + rect.width/2;
				const y = rect.top - contRect.top + rect.height/2;
				crearParticulas(x, y, cont);
				btn.addEventListener("animationend", () => btn.remove(), { once: true });
			});
		};
	});

	function crearBotones() {
		const botones = [
		{ texto: "GPS", accion: accionGPS },
		{ texto: "TRACKING", accion: accionTracking },
		{ texto: "MARCAR", accion: accionMarcar }
		];
		const espacio = sidebarTop.clientHeight / (botones.length + 1);
		botones.forEach((info, i) => {
			const b = document.createElement('button');
			b.textContent = info.texto;
			b.classList.add('boton', 'boton-fall');
			b.style.top = `${Math.round(espacio * (i + 1))}px`;
			b.style.animationDelay = `${i * 0.12}s`;
			b.addEventListener('click', info.accion);
			sidebarTop.appendChild(b);
		});
	};

	function subirBotones() {
		const botones = sidebarTop.querySelectorAll('.boton');
		botones.forEach((b, i) => {
			b.classList.remove('boton-fall');
			b.classList.add('boton-rise');
			b.style.animationDelay = `${i * 0.08}s`;
			b.addEventListener('animationend', () => b.remove(), { once:true });
		});
	}

	/* ---------- Toggle sidebar portrait ---------- */
	const MenuFlotante = document.getElementById("MenuFlotante");
	const panel = document.getElementById("panel");

	function esPortrait(){
		return window.matchMedia("(orientation: portrait)").matches;
	};

	function openClosePanel(){
		panel.classList.toggle("activo");
		const ab = panel.classList.contains("activo");
		document.body.classList.toggle("panel-abierto", ab);
		setTimeout(()=> mapa.invalidateSize(), 360);
	};

	/* FIX: evitar doble disparo */
	let bloqueo = false;
	MenuFlotante.addEventListener("click", (e) => {
		if (bloqueo) return;
		bloqueo = true;
		openClosePanel();
		setTimeout(()=> bloqueo=false, 250);
	});

	/* cerrar al tocar afuera */
	document.addEventListener("click", (e)=>{
		if (!esPortrait()) return;
		if (!panel.classList.contains("activo")) return;
		if (!panel.contains(e.target) && !MenuFlotante.contains(e.target)) {
			openClosePanel()
		};
	});


	// Selecciona el contenedor de los nuevos botones
	const sidebarBottom = document.getElementById("sidebarBottom");

	// FunciÃ³n para crear botones nuevos
	function generarBotonesNuevos(nombreGrupo) {
		// Limpia los antiguos
		sidebarBottom.innerHTML = "";

		// Lista de botones especÃ­ficos segÃºn cuÃ¡l se tocÃ³
		const botonesPorGrupo = {
			GPS: ["Centrar mapa", "Obtener coordenadas", "Modo precisiÃ³n"],
			TRACKING: ["Iniciar tracking", "Detener tracking", "Exportar ruta"],
			MARCAR: ["AÃ±adir marcador", "Eliminar marcador", "Lista de marcas"]
		};
		const lista = botonesPorGrupo[nombreGrupo];
		// Crear botones
		lista.forEach(txt => {
			const b = document.createElement("button");
			b.className = "new-btn";
			b.textContent = txt;
			// AquÃ­ le das funcionalidad real
			b.addEventListener("click", () => {
				console.log("Click en:", txt);
				// AquÃ­ luego agregamos funciones reales
			});
			sidebarBottom.appendChild(b);
		});
	};

	/* ajustes al girar */
	window.addEventListener("resize", refreshMap);
	window.addEventListener("orientationchange", ()=> setTimeout(refreshMap,300));
</script>
</body>
</html>
