<!DOCTYPE html>
<html lang="es">
<head>
	<!--Evitar recarga de caché por si hay actualizaciones
	<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
	<meta http-equiv="Pragma" content="no-cache">
	<meta http-equiv="Expires" content="0">
	--->
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<link type="text/css" rel="stylesheet" href='css\component-chosen.css'>
	<link type="text/css" rel="stylesheet" href='css\component-chosen.min.css'>
	<link type="text/css" rel="stylesheet" href='css\bootstrap.min.css'>
	<title>Mapa Congregación Sur Villa Nueva</title>
	<link rel="canonical" href="https://getbootstrap.com/docs/5.2/examples/dashboard/">
	<link rel="canonical" href="https://getbootstrap.com/docs/5.2/examples/modals/">
	<link href="modals.css" rel="stylesheet">
	<script src="geojson/casas.geojson" type="text/javascript"></script>
	<script src="geojson/territorios.geojson" type="text/javascript"></script>
	<script src="geojson/perimetro.geojson" type="text/javascript"></script>
	<script src="geojson/PerimetroLineal.geojson" type="text/javascript"></script>
	<script src="geojson/encuentros.json" type="text/javascript"></script>
	<script src="geojson/manzanas.geojson" type="text/javascript"></script>
	<script src="permisos.txt" type="text/javascript"></script>
	<!--<script src="contrasenia.txt" type="text/javascript"></script>-->
	<!-- JS -->
	<script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js"
	integrity="sha512-BB3hKbKWOc9Ez/TAwyWxNXeoV9c1v6FIeYiBieIWkpLjauysF18NzgR1MBNBXf8/KABdlkX68nAhlwcDFLGPCQ=="
	crossorigin=""></script>
	<!-- Turf.js para cálculos geométricos -->
	<script src="https://unpkg.com/@turf/turf/turf.min.js"></script>
	<!-- CSS -->
	<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css"
	integrity="sha512-hoalWLoI8r4UszCkZ5kL8vayOGVae1oxXe/2A4AO6J9+580uKHDO3JdHb7NzwwzK5xr/Fs0W40kiNHxM9vyTtQ=="
	crossorigin=""/>
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.1/dist/leaflet.css"/>
	<!-- Repositorios en línea y locales -->
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"/>
	<link rel="stylesheet" href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css"/>
	<link rel="stylesheet" href="libs/leaflet-measure-path.css"/>
	<link rel="stylesheet" href="./css/leaflet-sidebar.css"/>
	<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
	<script src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>
	<script src="https://code.jquery.com/jquery-3.6.1.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>
	<script src="libs/editable.js" ></script>
	<script src="libs/measure.js"></script>
	<script src="./js/leaflet-sidebar.js"></script>
	<script src="https://kit.fontawesome.com/68fa6cffda.js" crossorigin="anonymous"></script>
	<script src="js/jquery-3.4.1.min.js" ></script>
	<script src="js/chosen.jquery.js" type="text/javascript"></script>
	<!-- Leaflet Routing Machine -->
	<link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css" />
	<script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.min.js"></script>
	<!--Permiso para acceder a Google-Drive-->
	<script src="permisogoogledrive.txt" type="text/javascript"></script>
	<!-- Añado un pluging de minimapa -->
	<!--<script src="https://cdn.jsdelivr.net/gh/maneoverland/leaflet.WorldMiniMap@1.0.0/dist/Control.WorldMiniMap.js" integrity="sha512-PFw8St3qenU1/dmwCfiYYN/bRcqY1p3+sBATR+rZ6622eyXOk/8izVtlmm/k8qW7KbRIJsku838WCV5LMs6FCg==" crossorigin=""></script>-->
	
	<!--Clases para personalizar algunos elementos-->
	<meta name="theme-color" content="#712cf9"></meta>
	<style>
        body {
            padding: 0;
            margin: 0;
        }
        html, body, #map {
            height: 100%;
            font: 10pt "Helvetica Neue", Arial, Helvetica, sans-serif;
        }
        .lorem {
            font-style: italic;
            color: #AAA;
        }
		.popups.leaflet-popup-tip,
		.popups.leaflet-popup-content-wrapper {
		background-color: #3182bd;
		}
		.popups.leaflet-popup-tip,
		.popups.leaflet-popup-content-wrapper {
		background-color: #3182bd;
		}
		a{
		text-align: center;
		display: inline;
		width: 100%;
		}
		.botonnorte {
			position: absolute;
			top: 80px;
			right: 80px;
			background: red;
			border: none;
			cursor: pointer;
			padding: 0;
			z-index:1030;
		}
		.botonnorte img {
			width: 40px;
			height: 40px;
			border-radius: 10px;
			box-shadow: 0 2px 5px rgba(0,0,0,0.3);
			transition: transform 0.2s;
		}
		.botonnorte img:hover {
			transform: scale(1.5);
		}
		
		.botoncentrado {
			position: absolute;
			top: 130px;
			right: 80px;
			background: none;
			border: none;
			cursor: pointer;
			padding: 0;
			z-index:1030;
		}
		.botoncentrado img {
			width: 35px;
			height: 35px;
			border-radius: 10px;
			box-shadow: 0 2px 5px rgba(0,0,0,0.3);
			transition: transform 0.2s;
		}
		.botoncentrado img:hover {
			transform: scale(1.5);
		}
		#distancia {
			position: absolute;
			top: 10px;
			left: 50%;
			transform: translateX(-50%);
			background: "#d4edda";
			font-size: 16px;
			padding: 8px 14px;
			border-radius: 8px;
			box-shadow: 0 0 6px rgba(0,0,0,0.2);
			z-index: 999;
			font-weight: bold;
			transition: background 0.3s;
		}
		
		/*Modal Flash*/
		.modalflash {
			position: fixed;
			top: 45%;
			left: 50%;
			transform: translate(-50%, -50%);
			max-width: 75vh;
			max-height: 85vh;
			background-color: yellow;
			border-radius: 10px;
			box-shadow: 0 0 10px rgba(0,0,0,0.3);
			display: flex;
			flex-direction: column;
			z-index: 1000;
			overflow-y: auto;
		}
		.modalflash-cabecera {
			background-color: red;
			color: white;
			padding: 10px;
			text-align: center;
			font-weight: bold;
			border-top-left-radius: 10px;
			border-top-right-radius: 10px;
		}
		.modalflash-cuerpo {
			/*flex: 1;*/
			padding: 10px;
			/*text-align: center;*/
			/*display: flex;*/
			/*align-items: center;*/
			/*justify-content: center;*/
			/*display: flex;*/
			overflow-y: auto;
		}
		@media (max-width: 600px) {
			.modalflash {
			width: 80vw;
			height: 80vh;
			overflow-y: auto;
			}
		}
		
		/*Botón para recargar la página*/
		.boton-recargar {
			border: 3px solid #374151; background: linear-gradient(180deg, #1f2937, #111827);
			color: #22d3ee; border-radius: 14px; cursor: pointer; font-weight: 600; box-shadow: 0 6px 18px rgba(0,0,0,.35);
			transition: transform .08s ease, box-shadow .2s ease, border-color .2s ease; position:fixed;
			bottom:10px;right:30px; width: 200px; height: 50px;
		}
		.boton-recargar:hover {
			border-color: #22d3ee; box-shadow: 0 8px 24px rgba(34,211,238,.25);
		}
		.boton-recargar:active {
			transform: translateY(1px);
		}
		
		/*Botón para informar lo que se predicó*/
		.boton-predicado {
			border: 3px solid #374151; background: linear-gradient(180deg, #1f2937, #111827);
			color: #22d3ee; border-radius: 14px; cursor: pointer; font-weight: 600; box-shadow: 0 6px 18px rgba(0,0,0,.35);
			transition: transform .08s ease, box-shadow .2s ease, border-color .2s ease; position:fixed;
			bottom:130px;right:30px; width: 200px; height: 50px;
		}
		.boton-predicado:hover {
			border-color: #22d3ee; box-shadow: 0 8px 24px rgba(34,211,238,.25);
		}
		.boton-predicado:active {
			transform: translateY(1px);
		}
		
		/*Botón para informar un nuevo NO VISITAR*/
		.boton-novisitar {
			border: 3px solid #374151; background: linear-gradient(180deg, #1f2937, #111827);
			color: #22d3ee; border-radius: 14px; cursor: pointer; font-weight: 600; box-shadow: 0 6px 18px rgba(0,0,0,.35);
			transition: transform .08s ease, box-shadow .2s ease, border-color .2s ease; position:fixed;
			bottom:70px;right:30px; width: 200px; height: 50px;
		}
		.boton-novisitar:hover {
			border-color: #22d3ee; box-shadow: 0 8px 24px rgba(34,211,238,.25);
		}
		.boton-novisitar:active {
			transform: translateY(1px);
		}
		
		/*Bloque para el Calendario*/
		.controles {
			position: absolute; top: 12px; right: 12px; display: flex; flex-direction: column; gap: 10px; z-index: 500;
		}
		.boton-calendario {
			border: 3px solid #374151; background: linear-gradient(180deg, #1f2937, #111827);
			color: #22d3ee; border-radius: 14px; cursor: pointer; font-weight: 600; box-shadow: 0 6px 18px rgba(0,0,0,.35);
			transition: transform .08s ease, box-shadow .2s ease, border-color .2s ease; position:fixed;
			bottom:190px;right:30px; width: 200px; height: 50px;
		}
		.boton-calendario:hover {
			border-color: #22d3ee; box-shadow: 0 8px 24px rgba(34,211,238,.25);
		}
		.boton-calendario:active {
			transform: translateY(1px);
		}
		.pill {
			font-size: 12px; padding: 6px 10px; background: #0b1220; border: 1px solid #374151; border-radius: 999px; color:#9ca3af;
		}
		.pill strong {
			color: #38bdf8;
		}
		
		/*Fondo Oscurecido*/
		/*.modal-calendario {*/
			/*position: fixed; inset: 0; background: rgba(3,7,18,.6); backdrop-filter: blur(2px); display: none; z-index: 1000; place-items: center start;*/
		/*}*/
		/*.modal-calendario[aria-hidden="false"] {*/
			/*display: grid;*/
		/*}*/
		
		/* Fondo oscuro con blur */
		.capaoscura {
			position: fixed;
			inset: 0;
			background: rgba(3,7,18,.6);
			backdrop-filter: blur(5px);
			display: none;
			align-items: center;
			justify-content: center;
			z-index: 1000;
		}
		.capaoscura.active {
			display: flex;
		}

		/* Contenedor de modales */
		.modales {
			background: #111827ee;
			display: grid;
			gap: 1rem;
			width: 90%;
			max-width: 800px;
			max-height: 350px;
			margin-left: 25px;
		}
		@media (min-width: 700px) {
			.modales {
				grid-template-columns: 1fr 1fr;
			}
		}
		
		/*Formato de los elementos dialog*/
		dialog {
			max-width: 70%;
			max-height: 70%;   /* limita la altura del contenido */
			overflow-y: auto;     /* activa la barra de desplazamiento vertical */
		}

		.modal {
			background: pink;
			padding: 1rem;
			border-radius: 12px;
			box-shadow: 0 4px 12px rgba(0,0,0,0.3);
			position: relative;
			min-width: 250px;
		}

		.modal h2 {
			margin-top: 0;
		}
  
		.modalcal {
			justify-self: start; margin-left: 20%; margin-top:20%; background: #111827ee; border: 1px solid #374151; border-radius: 18px; box-shadow: 0 30px 80px rgba(0,0,0,.5); overflow: hidden; width:25%;/*width: min(92vw, 420px);*/
			/*justify-self: start; margin-left: 20%; background: #111827ee; border: 1px solid #374151; border-radius: 18px; box-shadow: 0 30px 80px rgba(0,0,0,.5); overflow: hidden; width:30%; height:75%;/*width: min(92vw, 420px);*/*/
		}
		.modalcal-cabecera {
			display: flex; align-items: center; justify-content: space-between; padding: 14px 16px; border-bottom: 1px solid #374151;
		}
		.modalcal-titulo {
			font-weight: 700; letter-spacing: .2px;color:#22d3ee;
		}
		.modalcal-cerrar {
			background: transparent; color: #9ca3af; border: none; font-size: 18px; cursor: pointer; padding: 6px 8px; border-radius: 10px;
		}
		.modalcal-cerrar:hover {
			color: #e5e7eb; background: #0b1220;
		}
		.calendario {
			padding: 12px 16px 18px;
		}
		.calendario-grid {
			display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px;
		}
		.calendario-semana {
			text-align: center; font-size: 12px; color: #9ca3af; padding: 8px 0;
		}
		.calendario-dia {
			text-align: center; padding: 10px 0; border: 1px solid #374151; border-radius: 12px; cursor: pointer; user-select: none; transition: transform .06s ease, border-color .2s ease, background .2s ease;
		}
		.calendario-dia:hover {
			border-color: #22d3ee;
		}
		.calendario-dia:active {
			transform: translateY(1px);
		}
		.calendario-dia[aria-disabled="true"] {
			opacity: .28; cursor: not-allowed;
		}
		.calendario-dia.hoydia {
			outline: 2px solid #38bdf8; outline-offset: 2px;
		}
		.calendario-dia.selected {
			background: linear-gradient(180deg, #0ea5e9, #0891b2); border-color: #06b6d4; color: white;
		}
		.calendario-encabezado {
			display: flex; justify-content: space-between; align-items: center; margin-top: 12px; font-size: 13px; color: #9ca3af;
		}
		.modalsal {
			justify-self: start; margin-left: 40%; margin-top:10%; background: #111827ee; border: 1px solid #374151; border-radius: 18px; box-shadow: 0 30px 80px rgba(0,0,0,.5); overflow: hidden; width: 25%;/*width: min(92vw, 420px);*/
			/*justify-self: start; margin-left: 70%; background: #111827ee; border: 1px solid #374151; border-radius: 18px; box-shadow: 0 30px 80px rgba(0,0,0,.5); overflow: hidden; width: 30%; height:75%;/*width: min(92vw, 420px);*/*/
		}
		.modalsal-cabecera {
			display: flex; align-items: center; justify-content: space-between; padding: 14px 16px; border-bottom: 1px solid #374151;
		}
		.modalsal-titulo {
			font-weight: 700; letter-spacing: .2px;color:#22d3ee;
		}
		.modalsal-cerrar {
			background: transparent; color: #9ca3af; border: none; font-size: 18px; cursor: pointer; padding: 6px 8px; border-radius: 10px;
		}
		.modalsal-cerrar:hover {
			color: #e5e7eb; background: #0b1220;
		}
		.infosalidas {
			height:300px; padding: 12px 16px 18px;
			overflow: auto;
		}
		
		/*Cuadro animado*/
		.colorful-div {
			width: 300px;
			height: 10%;
			border-radius: 20px;
			background: linear-gradient(270deg, #ff5f6d, #ffc371, #24c6dc, #514a9d);
			background-size: 800% 800%;
			animation: gradientShift 10s ease infinite;
			display: flex;
			justify-content: center;
			align-items: center;
			color: white;
			font-size: 1rem;
			box-shadow: 0 10px 25px rgba(0,0,0,0.3);
			text-align: center;
		}

		@keyframes gradientShift {
			0% { background-position: 0% 50%; }
			50% { background-position: 100% 50%; }
			100% { background-position: 0% 50%; }
		}
		/*Iconos manzanas*/
		.circle-label {
			font-size: 14px;
			font-weight: bold;
			color: white;
			text-align: center;
			text-shadow: 0 0 2px black;
		}
		
		/*Bloque para resaltar lo NUEVO*/
		/* Clase resaltado con animación */
		.resaltarlonovedoso {
			animation: palpitar 1s infinite ease-in-out, cambiarColor 2s infinite alternate;
		}
		/* Palpitar (latido) */
		@keyframes palpitar {
			0%   { transform: scale(1); }
			50%  { transform: scale(1.8); }
			100% { transform: scale(1); }
		}
		/* Cambiar color entre dos tonos */
		@keyframes cambiarColor {
			0%   {background: #F4A60B; color: red;}
			50%  {background: #011806; color: yellow;}
			100% {background: #F4A60B; color: red;}
		}
		
		/* el botón al que apunta la flecha */
		.area-ejemplo{display:flex;gap:20px;align-items:center}
		button{padding:10px 16px;border-radius:8px;border:1px solid #ddd;background:#fff;cursor:pointer}
		.primario{background:green;color:#fff;border:none}

		/* capa y modal (tooltip grande) */
		.capa{position:fixed;inset:0;background:transparent;display:none;z-index:1500}
		.capa.active{display:block}

		/* guía/tooltip */
		.guia{
		position:absolute;max-width:320px;padding:14px 16px;border-radius:10px;background:#a1d99b;box-shadow:0 8px 22px rgba(0,0,0,0.18);z-index:500;cursor:pointer;transform-origin:center top;transition:transform .14s ease,opacity .12s ease;opacity:0;transform:translateY(-6px);color:green;
		}
		.guia.show{opacity:1;transform:translateY(0)}

		/* flecha: apuntando hacia abajo (modal encima del botón) */
		.guia::after{
		content:"";position:absolute;width:14px;height:14px;background:red;transform:rotate(45deg);left:50%;transform-origin:center;box-shadow:0 4px 8px rgba(0,0,0,0.08);
		/* se colocará con JS ajustando --arrow-x */
		top:100%;margin-left:calc(var(--arrow-x, -7px));
		}

		/* cuando el modal está debajo del botón, usamos la clase bottom y movemos la flecha arriba */
		.guia.bottom::after{top:auto;bottom:100%;}

		/* texto dentro de la guía */
		.guia h4{margin:0 0 6px 0;font-size:15px}
		.guia p{margin:0;font-size:13px;color:#444}

		/* estilo pequeño para indicar acción */
		.hint{margin-top:10px;font-size:12px;color:#666}

		@media (max-width:420px){
		.guia{left:8px;right:8px;max-width:calc(100% - 16px)}
		}
    </style>
	<!--Icono para la pestaña del navegador-->
	<link rel="shortcut icon" href="./images/Tetragramaton.ico" type="image/x-icon"/>
</head>
<header class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0 shadow">
	<a style="font-size:15px; color:#22d3ee; display=inline-block"><strong>MAPA DE TERRITORIOS DE LA CONGREGACION SUR VILLA NUEVA (Nº 6379)</strong></a>
	<div id="ubicacion">
		<div id="activargps" class="colorful-div">¿Necesitás indicaciones para llegar? Activá aquí...</div>
		<div id="ubicacion_texto" style="font-size:10px; text-align:right; background-color:grey; color:blue"><strong>Activar/Desactivar mi ubicación</strong><a id="ubicacion_estado" href="javascript:activar_seguimiento()"><img id="gps" src="images/slide_off.jpg" width="50" height="30"></img></a></div>
	</div>
	<img src="images/Tetragramaton.jpg" width="60" height="60"></img>
</header>
<header>
	<div id="texto_ayuda">
		<a style="font-size:12px; text-align:left-side; color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/flecha_izquierda.png" width="20" height="20"></img>Si necesitás ayuda, tocá las tres líneas en la parte superior de la barra izquierda</a>
	</div>
</header>
<body>
	<div id="barralateral" class="sidebar collapsed">
        <div class="sidebar-tabs">
            <ul role="tablist">
                <li><a href="#home" role="tab"><i class="fa fa-bars" style="color: #3f08f2;"></i></a></li>
				<li><a href="#mapita" role="tab"><i class="fa fa-map-location-dot" style="color: #3f08f2;"></i></a></li>
				<li><a id="casas_hnos" href="#familias" role="tab"><i class="fa-solid fa-house" style="color: #3f08f2;"></i></a></li>
				<li><a href="#configuracion" role="tab"><i class="fa-solid fa-gear" style="color: #3f08f2;"></i></a></li>
				<li><a href="#ayuda" role="tab"><i class="fa-solid fa-circle-info" style="color: #3f08f2;"></i></a></li>
            </ul>
            <ul role="tablist">
				<li><a id="localizacion" href="#localizacion" role="tab"><i class="fa-solid fa-crosshairs" style="color: #3f08f2;"></i></a></li>
				<li><a href="#logueo" role="tab"><i class="fa fa-user" style="color: #3f08f2;"></i></a></li>
            </ul>
        </div>

        <div class="sidebar-content">
            <div class="sidebar-pane" id="home">
                <h1 class="sidebar-header">
                    BARRA DE OPCIONES
                    <span class="sidebar-close"><i class="fa fa-caret-left"></i></span>
                </h1>
				<br></br>
				<p style="color:blue"><strong>¿Cómo funciona cada herramienta de esta barra?</strong></p>
				<br></br>
				<p class="lorem"><i class="fa fa-map-location-dot" style="color: #3f08f2;"></i>Te ayudará a encontrar un territorio</p>
				<br></br>
                <p class="lorem"><i class="fa-solid fa-house" style="color: #3f08f2;"></i>Te ayudará a encontrar la casa de un publicador</br>(En caso que estés registrado como usuario)</p>
				<br></br>
				<p class="lorem"><i class="fa-solid fa-gear" style="color: #3f08f2;"></i>Te permitirá acceder a las herramientas de configuración disponibles</p>
				<br></br>
                <p class="lorem"><i class="fa-solid fa-circle-info" style="color: #3f08f2;"></i>Te dará detalles sobre cómo usar cada herramienta</p>
				<br></br>
                <p class="lorem"><i class="fa-solid fa-crosshairs" style="color: #3f08f2;"></i>En caso que tengás el GPS activado, centrará el mapa sobre tu ubicación actual</p>
				<br></br>
				<p class="lorem"><i class="fa fa-user" style="color: #3f08f2;"></i>Sección para usuarios registrados</p>
				<br></br>
				<br></br>
				<br></br>
				<br></br>
				<br></br>
				<p class="lorem"><i class="fa-solid fa-circle-exclamation" style="color: #3f08f2;"></i>¿Encontraste algún problema o tenés alguna sugerencia para mejorar este sitio?</p>
				<p class="lorem">Por favor, comunicate con alguno de los ancianos.-</p>
            </div>
            <div class="sidebar-pane" id="mapita">
                <h1 class="sidebar-header">Buscar el territorio...<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
				<br></br>
				<p id="titulobuscarterritorio" class="lorem">Escribí o seleccioná el territorio...</p>
				<select id="selector_territorios" name="CasasHnos" data-placeholder="- Seleccioná o escribí el territorio que deseás ubicar -"
					class="form-control chosenCasas" value="<%= typeof Casas != 'undefined' ? Casas : '' %>" onchange="TerritorioAbuscar(value,'territorio')">
					<option value=""></option>
				</select>
				<br></br>
				<p id="parrafoterritorio" style="color:blue">Escribe el número del territorio que deseás ubicar o bien elegilo desde el menú desplegable y te centrará el mapa sobre él, mostrándote su información, tal como nombre de los barrios que abarca y lista de casas "NO VISITAR".</p>
            </div>
			<div class="sidebar-pane" id="familias">				
				<h1 class="sidebar-header">Buscar la casa...<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
				<br></br>
				<p id="titulobuscarflia" class="lorem">Escribí o seleccioná una familia...</p>
				<select id="selector_casas" name="CasasHnos" data-placeholder="- Seleccioná o escribí la familia o hermano que deseás ubicar -"
					class="form-control chosenCasas" value="<%= typeof Casas != 'undefined' ? Casas : '' %>" onchange="CasaAbuscar(value)">
					<option value=""></option>
				</select>
				<br></br>
				<p id="parrafofamilia" style="color:blue">Escribe algún dato que conozcas del publicador o familia que deseás ubicar (nombre y/o apellido) o bien elegilo desde el menú desplegable y te centrará el mapa sobre su casa, mostrándote información, tal como nombres de los integrantes de la familia, privilegios de servicio, dirección postal, teléfono y foto del frente de la casa para que podás identificarla al llegar.</p>
				<br></br>
				<p>
					<input id="mostrarflias" type="submit" style="background-color:#acf89f" value="Ver todas las familias" onclick="VerTodasFlias();"></input>
					<input id="ocultarflias" type="submit" style="background-color:#f48d8d" value="Quitar familias del mapa" onclick="QuitarTodasFlias();"></input>
				</p>
            </div>
			<div class="sidebar-pane" id="configuracion">
                <h1 class="sidebar-header">Sección de configuración<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
				<br></br>
				<p class="lorem"><i class="fa-solid fa-message" style="color: #3f08f2;"></i>Te permitirá restablecer los mensajes informativos que puedas haber cancelado.</p>
				<br></br>
				<p id="restablecernomostrar"><a href="#" onclick="RestablecerNoMostrar(); return false;" style="color:blue;">Volver a mostrar mensajes informativos.</a></p>
            </div>
			<div class="sidebar-pane" id="ayuda">
                <h1 class="sidebar-header">Sección de información de ayuda<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
				<br></br>
				<p class="lorem"><i class="fa fa-map-location-dot" style="color: #3f08f2;"></i>Te ayudará a encontrar un territorio</p>
				<br></br>
				<p>Escribe el número del territorio que deseás ubicar o bien elegilo desde el menú desplegable y te centrará el mapa sobre él, mostrándote su información, tal como nombre de los barrios que abarca y lista de casas "NO VISITAR".</p>
				<br></br>
				<div id="ayuda_usuario">
					<p class="lorem"><i class="fa-solid fa-house" style="color: #3f08f2;"></i>Te ayudará a encontrar la casa de un publicador</br>(En caso que estés registrado como usuario)</p>
					<br></br>
					<p>Escribe algún dato que conozcas del publicador o familia que deseás ubicar (nombre y/o apellido) o bien elegilo desde el menú desplegable y te centrará el mapa sobre su casa, mostrándote información, tal como nombres de los integrantes de la familia, privilegios de servicio, dirección postal, teléfono y foto del frente de la casa para que puedan identificarla al llegar.</p>
				</div>
				<br></br>
				<p class="lorem"><i class="fa fa-user" style="color: #3f08f2;"></i>Sección para usuarios registrados</p>
				<br></br>
				<br></br>
				<br></br>
				<br></br>
				<br></br>
				<p class="lorem"><i class="fa-solid fa-circle-exclamation" style="color: #3f08f2;"></i>¿Encontraste algún problema o tenés alguna sugerencia para mejorar este sitio?</p>
				<p class="lorem">Por favor, comunicate con alguno de los ancianos.-</p>
            </div>
			<div class="sidebar-pane" id="logueo">
                <div id="log_no">
					<h1 class="sidebar-header">Por favor, ingrese sus datos...<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
					<p class="lorem">Usuario:</p>
					<input type="text" id="username" name="username" value="">
					<p class="lorem">Contraseña:</p>
					<input type="password" id="password" name="password" value="">
					<input type="submit" value="Mostrar/Ocultar" onclick="Contrasenia();">
					<br><br>
					<input type="submit" style="background-color:#acf89f" value="Ingresar" onclick="Loguearse();">
				</div>
				<div id="log_si">
					<br></br>
					<input type="submit" style="background-color:#f48d8d" value="Cerrar sesión" onclick="CerrarSesion();"></input>
				</div>
            </div>
        </div>
    </div>
	
	<div id="mapa" style="width:100%;height:90%;">
		<div id="distancia">Buscando ubicacion...</div>
		<button class="botoncentrado" id="botoncentrado" onclick="CentrarMiUbicacion()" title="Centrar en mi ubicación real">
			<img src="./images/posicion.png" alt="Centrar en Mi Ubicación">
		</button>
		<button class="botonnorte" id="botonnorte">
			<img src="./images/norte.jpg" alt="Norte del Mapa" title="Norte terrestre">
		</button>
		<!--Botón para el Calendario-->
		<div class="controles">
			<button  class="boton-calendario" id="botonsalidas" onclick="AbrirModalCalendario('modal1')">Salidas del mes...</button>
		</div>
		<!--Botón para informar los territorios predicados-->
		<div class="controles">
			<button id="botonreportarpredicado" class="boton-predicado" onclick="ReportarPredicado()">¿Dirigiste una salida? Por favor, informá qué se predicó</button>
		</div>
		<!--Botón para informar NO VISITAR nuevos-->
		<div class="controles">
			<button id="botonreportarnovisitar" class="boton-novisitar" onclick="ReportarNoVisitar()">Una persona pidió que no la visitemos más...</button>
		</div>
		<!--Botón para recargar la página-->
		<div class="controles">
			<button id="botonrecargar" class="boton-recargar" onclick="location.reload()">Volver a empezar...</button>
		</div>
	</div>
	
	<div class="modalflash" id="MiModalFlash" style="font-size:14px;">
		<div class="modalflash-cabecera" id="titulomodalflash">¡¡¡ BIENVENIDO AL MAPA WEB DE LA CONGREGACION SUR VILLA NUEVA...!!!</div>
		<p class="modalflash-cuerpo" id="cuerpomodalflash"><img src="./images/presentacion.jpg" style="display: block; margin: auto; height:80px" id="imagenmodalflash"/><br><strong>Si sos un publicador, este mapa en línea te permitirá:</strong>
			<br>Ubicar un territorio con la opción de hacerlo a partir de tu ubicación en tiempo real.
			<br>
			<br>Es decir, si vos se lo autorizás, te trazará una ruta con las indicaciones necesarias para llegar...!!!. Te incluirá una distancia y demora estimadas y hasta te avisará con voz cuando estés cerca y cuando hayás llegado...!!!
			<br>
			<br>Podrás consultar las salidas del mes en curso y si dirigiste alguna salida, podrás enviarle los detalles de lo que se abarcó al hermano encargado de los territorios.
			<br>
			<br><br><strong>Por otra parte, si sos el viajante, además podrás:</strong>
			<br>Localizar las casas y los puntos donde puedas tener tus arreglos para almuerzos, pastoreos y actividad.
			<br><br><strong>En la barra lateral podrás encontrar secciones con las herramientas disponibles y un apartado de ayuda para orientarte a encontrarlas y saber su función.-</strong>
			<br>
			<div style="text-align: center">
				<label id="borrableinicial">
					<input id="nomostrarinicial" type="checkbox" style="width:16px; height:16px;"/>
					No volver a mostrar
				</label>
				<button id="btn-indicaciones-modal-flash" style="height:30px; width:90px; background-color:blue;border-color:white;color:white;" onclick="TrazarRuta()">Sí, por favor</button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp
				<button id="btn-cerrar-modal-flash" style="height:30px; width:90px; background-color:red;border-color:white;color:white;">Cerrar</button>
			</div>
			<span style="font-weight: bold; color:red; text-align: center;">Me cierro en: <span id="contador"> </span> segundos</span>
		</p>
	</div>
	
	<!--Modal para reportar lo que se predicó en una salida-->
	<div class="modalflash" id="ModalReportePredicado" style="font-size:15px;">
		<div class="modalflash-cabecera" id="titulomodalpredicado">¡¡¡ MUCHAS GRACIAS POR TOMARTE ESTE TIEMPITO...!!!</div>
		<p></p>
		<p class="modalflash-cuerpo" id="cuerpomodalpredicado"><strong>Estos registros ayudan a predicar a conciencia nuestro territorio</strong>
			<p></p>
			<label>Fecha: <input id="fechapredicado" type="date" style="width:50%;"></label><br>
			<label>Tu nombre: <input id="nombrepredicado" style="width:50%;"></label><br>
			<label>Número del territorio: <input id="territoriopredicado" style="width:50%;"></label><br>
			<label>¿Se predicó TODO el territorio?  <input type="checkbox" id="todopredicado">SI&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<input type="checkbox" id="algopredicado">NO</label><br><br>
			<label id="manzanaspredicadas">Lo que se abarcó: <input id="abarcadopredicado" placeholder="Letras de las manzanas predicadas" style="width:50%;"></label><br><br>
			<label id="leyendamanzanaspredicadas">Para identificar las manzanas, debés hacer Zoom en el territorio. Para ello, podés usar el símbolo + sobre el costado derecho, o tocar dos veces seguidas en el territorio o bien tocar la pantalla con dos dedos y separarlos lentamente.-</label>
			<p></p>
			<pre id="enviandoreporte"></pre>
			<div style="text-align: center">
				<button id="btn-cerrar-reporte" style="height:35px; width:30%; background-color:red;border-color:white;color:white;" onclick="CerrarModalReporte()">Cerrar</button>
				<button id="btn-enviar-reporte" style="height:35px; width:30%; background-color:green;border-color:white;color:white;">Enviar información</button>
			</div>
			<p></p>
			<p></p>
			<pre id="enviandoreporte"></pre>
		</p>
	</div>
	
	<!--Modal para reportar una nueva casa NO VISITAR-->
	<div class="modalflash" id="ModalReporteNoVisitar" style="font-size:15px;">
		<div class="modalflash-cabecera" id="titulomodalnovisitar">¡¡¡ MUCHAS GRACIAS POR TOMARTE ESTE TIEMPITO...!!!</div>
		<p></p>
		<p class="modalflash-cuerpo" id="cuerpomodalnovisitar"><strong>Informar de una casa donde han pedido que no los volvamos a visitar, ayuda a resguardar la seguridad de nuestros hermanos y también puede ser una manera indirecta de dar testimonio.-</strong>
			<p></p>
			<label>Tu nombre: <input id="nombrenovisitar" style="width:50%;"></label><br>
			<label>Fecha: <input id="fechanovisitar" type="date" style="width:50%;"></label><br>
			<label>Dirección: <input id="direccionnovisitar" style="width:50%;"></label><br>
			<label>Número del territorio: <input id="territorionovisitar" style="width:20%;"></label><br>
			<label>La persona, ¿pidió expresamente que no la visitemos más?  <input type="checkbox" id="expresonovisitar">SI&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<input type="checkbox" id="noexpresonovisitar">NO</label><br><br>
			<label id="motivonovisitar">Si la persona no dijo "NO QUIERO QUE ME VUELVAN A VISITAR", ¿Por qué considerás que no deberíamos volver?. ¿Qué te dijo y cómo actuó?  <input id="detallemotivonovisitar" placeholder="Indicá en detalles lo que te dijo e hizo la persona..." style="width:50%;"></label>
			<label id="leyendadetallemotivonovisitar">Por favor, describí lo más claramente posible lo que te dijeron para evaluar si añadimos la casa a la lista de NO VISITAR.-</label>
			<p></p>
			<pre id="enviandoreportenovisitar"></pre>
			<div style="text-align: center">
				<button id="btn-cerrar-reportenovisitar" style="height:30px; width:30%; background-color:red;border-color:white;color:white;" onclick="CerrarModalNoVisitar()">Cerrar</button>
				<button id="btn-enviar-reportenovisitar" style="height:30px; width:30%; background-color:green;border-color:white;color:white;">Enviar información</button>
			</div>
			<p></p>
			<p></p>
			<pre id="enviandoreporte"></pre>
		</p>
	</div>
	
	<!--Bloque para el Calendario-->
    <!-- Modal Calendario -->
	<div id="ModalCalendario" class="capaoscura">
		<div id="modal1" class="modales">
			<div class="modalcal-cabecera">
				<div class="modalcal-titulo" id="TituloCalendario">Calendario</div>
				<button class="modalcal-cerrar" onclick="CerrarModalCalendario('modal1')">✕</button>
			</div>
			<div class="calendario">
				<div class="calendario-grid" id="diasdelasemana"></div>
				<div class="calendario-grid" id="dias"></div>
				<div class="calendario-encabezado">
					<span id="mesactual"></span>
					<button class="boton-calendario" id="BorrarFecha" style="padding:6px 10px;font-size:12px"></button>
				</div>
			</div>
		</div>
		<!--Modal Salidas-->
		<div id="modal2" class="modales" style="display:none;">
			<div class="modalsal-cabecera">
				<div class="modalsal-titulo" id="titulo-modalsal"></div>
				<button class="modalsal-cerrar" onclick="CerrarModalCalendario('modal2')">✕</button>
			</div>
			<div class="infosalidas" id="DetallesSalidas"></div>
		</div>
	</div>
	
	<!--Bloque Modal LO NUEVO-->
	<div class="area-ejemplo">
		<button id="objetivo" class="primario" style="position: absolute; top: 10px; left: 10px;">Botón objetivo</button>
		<button id="buscar">Mostrar guía</button>
	</div>

	<!-- capa captura clicks fuera -->
	<div id="capa" class="capa" aria-hidden="true"></div>

	<!-- la guía/modal con flecha (se posiciona con JS) -->
	<div id="guia" class="guia" role="dialog" aria-modal="true" style="display:none">
		<h4><strong>Esto es algo NUEVO...!!!</strong></h4>
		<p style="color:green";>A partir de ahora, vas a poder informar una nueva casa "NO VISITAR" usando este botón.</p>
	</div>
	
</body>
	<!--Ventana modal inicial-->
	<dialog id="modal_inicial" style="text-align: center; background-color:yellow; font-size:13px;">
		<div id="Apaisado">
			<span id="titulo_modalinicial"><h4>Parece que estás usando un dispositivo movil (celular o tablet).</h4></span>
			<br><br/>
			<span id="cuerpo_modalinicial"><h4>En caso que no veas los mensajes completos o todas las herramientas,<br/>probá de girar la pantalla. Eso hará que tengas una mejor visión del mapa y sus herramientas.-</h4>
			<br/>Recordá que en todo momento disponés de distintas herramientas sobre la barra lateral izquierda.<br/>¿Querés saber cómo funcionan? Tocá las tres líneas de su parte superior y recibirás ayuda.</span>
		</div>
		<div id="Conectividad">
			<span id="titulo_modalconectividad"><h4>Parece que no tenés conexión a Internet.</h4></span>
			<span id="cuerpo_modalconectividad"><h2><br/>Por favor solucioná eso porque algunas herramientas no funcionarán correctamente.</h2></span>
		</div>
		<div style="text-align: right">
			<label id="borrablecelular">
				<input id="nomostrarcelular" type="checkbox" style="width:16px; height:16px;"/>
				No volver a mostrar
			</label>
			<button id="btn-cerrar-modal-inicial" style="height:30px; width:90px; background-color:red;border-color:white;color:white">Ok. Cerrar</button>
		</div>
	</dialog>
	<script>
	
	
		<!--Programa de salidas en formato JSON-->
		var salidas=[
			{
			"DiaSemana": "Miercoles",
			"Dia": 1,
			"Mes": 10,
			"Anio": 2025,
			"HoraM": "09:30",
			"PuntoEncuentroM": "Jose Ortiz",
			"SalidaM": "Congregacional",
			"ConductorM": "Juan Carlos Vidal",
			"TerritorioM": 20,
			"HoraT": "18:00",
			"PuntoEncuentroT": "Gutierrez",
			"SalidaT": "Congregacional",
			"ConductorT": "Juan Carlos Vidal",
			"TerritorioT": 13,
			"HoraN": "",
			"PuntoEncuentroN": "",
			"SalidaN": "",
			"ConductorN": "",
			"TerritorioN": ""
		  },
		  {
			"DiaSemana": "Jueves",
			"Dia": 2,
			"Mes": 10,
			"Anio": 2025,
			"HoraM": "09:30",
			"PuntoEncuentroM": "Candia",
			"SalidaM": "Congregacional",
			"ConductorM": "Juan Carlos Vidal",
			"TerritorioM": 16,
			"HoraT": "18:00",
			"PuntoEncuentroT": "Zoom",
			"SalidaT": "Congregacional",
			"ConductorT": "Emanuel Gualpa",
			"TerritorioT": "",
			"HoraN": "",
			"PuntoEncuentroN": "",
			"SalidaN": "",
			"ConductorN": "",
			"TerritorioN": ""
		  },
		  {
			"DiaSemana": "Viernes",
			"Dia": 3,
			"Mes": 10,
			"Anio": 2025,
			"HoraM": "09:30",
			"PuntoEncuentroM": "Hector Ortiz",
			"SalidaM": "Congregacional",
			"ConductorM": "Juan Carlos Vidal",
			"TerritorioM": 12,
			"HoraT": "18:00",
			"PuntoEncuentroT": "Jose Ortiz",
			"SalidaT": "Congregacional",
			"ConductorT": "Juan Carlos Vidal",
			"TerritorioT": 17,
			"HoraN": "20:00",
			"PuntoEncuentroN": "Zoom",
			"SalidaN": "Congregacional",
			"ConductorN": "Emanuel Gualpa",
			"TerritorioN": ""
		  },
		  {
			"DiaSemana": "Sabado",
			"Dia": 4,
			"Mes": 10,
			"Anio": 2025,
			"HoraM": "10:15",
			"PuntoEncuentroM": "Galdames",
			"SalidaM": "Congregacional",
			"ConductorM": "Juan Carlos Vidal",
			"TerritorioM": "11, 15",
			"HoraT": "18:00",
			"PuntoEncuentroT": "Jose Quiroga",
			"SalidaT": "Congregacional",
			"ConductorT": "Juan Carlos Vidal",
			"TerritorioT": "9-10",
			"HoraN": "",
			"PuntoEncuentroN": "",
			"SalidaN": "",
			"ConductorN": "",
			"TerritorioN": ""
		  },
		  {
			"DiaSemana": "Domingo",
			"Dia": 5,
			"Mes": 10,
			"Anio": 2025,
			"HoraM": "",
			"PuntoEncuentroM": "",
			"SalidaM": "",
			"ConductorM": "",
			"TerritorioM": "",
			"HoraT": "",
			"PuntoEncuentroT": "",
			"SalidaT": "",
			"ConductorT": "",
			"TerritorioT": "",
			"HoraN": "",
			"PuntoEncuentroN": "",
			"SalidaN": "",
			"ConductorN": "",
			"TerritorioN": ""
		  },
		  {
			"DiaSemana": "Lunes",
			"Dia": 6,
			"Mes": 10,
			"Anio": 2025,
			"HoraM": "",
			"PuntoEncuentroM": "",
			"SalidaM": "",
			"ConductorM": "",
			"TerritorioM": "",
			"HoraT": "18:00",
			"PuntoEncuentroT": "Zoom",
			"SalidaT": "Congregacional",
			"ConductorT": "Emanuel Gualpa",
			"TerritorioT": "",
			"HoraN": "",
			"PuntoEncuentroN": "",
			"SalidaN": "",
			"ConductorN": "",
			"TerritorioN": ""
		  },
		  {
			"DiaSemana": "Martes",
			"Dia": 7,
			"Mes": 10,
			"Anio": 2025,
			"HoraM": "09:30",
			"PuntoEncuentroM": "Curupaiti y Elpidio Gonzalez",
			"SalidaM": "Congregacional",
			"ConductorM": "Hector Ortiz",
			"TerritorioM": 22,
			"HoraT": "18:00",
			"PuntoEncuentroT": "Curupaiti y Castro",
			"SalidaT": "Congregacional",
			"ConductorT": "Carlos Caba�ez",
			"TerritorioT": 26,
			"HoraN": "",
			"PuntoEncuentroN": "",
			"SalidaN": "",
			"ConductorN": "",
			"TerritorioN": ""
		  },
		  {
			"DiaSemana": "Miercoles",
			"Dia": 8,
			"Mes": 10,
			"Anio": 2025,
			"HoraM": "09:30",
			"PuntoEncuentroM": "Curupaiti y Castro",
			"SalidaM": "Congregacional",
			"ConductorM": "Jose Ortiz",
			"TerritorioM": 27,
			"HoraT": "18:00",
			"PuntoEncuentroT": "Tapon Moyano y Boulevard",
			"SalidaT": "Congregacional",
			"ConductorT": "Roberto Garcia",
			"TerritorioT": 4,
			"HoraN": "",
			"PuntoEncuentroN": "",
			"SalidaN": "",
			"ConductorN": "",
			"TerritorioN": ""
		  },
		  {
			"DiaSemana": "Jueves",
			"Dia": 9,
			"Mes": 10,
			"Anio": 2025,
			"HoraM": "09:30",
			"PuntoEncuentroM": "Zoom",
			"SalidaM": "Congregacional",
			"ConductorM": "Joaquin Rossi",
			"TerritorioM": "",
			"HoraT": "",
			"PuntoEncuentroT": "",
			"SalidaT": "",
			"ConductorT": "",
			"TerritorioT": "",
			"HoraN": "",
			"PuntoEncuentroN": "",
			"SalidaN": "",
			"ConductorN": "",
			"TerritorioN": ""
		  },
		  {
			"DiaSemana": "Viernes",
			"Dia": 10,
			"Mes": 10,
			"Anio": 2025,
			"HoraM": "09:30",
			"PuntoEncuentroM": "Curupaiti y Castro",
			"SalidaM": "Congregacional",
			"ConductorM": "Oscar Galdames",
			"TerritorioM": 29,
			"HoraT": "18:00",
			"PuntoEncuentroT": "Pedro Goyena y 9 de Julio",
			"SalidaT": "Congregacional",
			"ConductorT": "Jose Quiroga",
			"TerritorioT": 16,
			"HoraN": "20:00",
			"PuntoEncuentroN": "Zoom",
			"SalidaN": "Congregacional",
			"ConductorN": "Emanuel Gualpa",
			"TerritorioN": ""
		  },
		  {
			"DiaSemana": "Sabado",
			"Dia": 11,
			"Mes": 10,
			"Anio": 2025,
			"HoraM": "09:30",
			"PuntoEncuentroM": "Jose Quiroga",
			"SalidaM": "Grupos 1 y 2",
			"ConductorM": "Roque Castillo",
			"TerritorioM": 6,
			"HoraT": "18:00",
			"PuntoEncuentroT": "Pedro Goyena y 9 de Julio",
			"SalidaT": "Congregacional",
			"ConductorT": "Oscar Mu�oz",
			"TerritorioT": 10,
			"HoraN": "",
			"PuntoEncuentroN": "",
			"SalidaN": "",
			"ConductorN": "",
			"TerritorioN": ""
		  },
		  {
			"DiaSemana": "Sabado",
			"Dia": 11,
			"Mes": 10,
			"Anio": 2025,
			"HoraM": "09:30",
			"PuntoEncuentroM": "Centro de Salud",
			"SalidaM": "Grupos 3 y 4",
			"ConductorM": "Daniel del Balso",
			"TerritorioM": 13,
			"HoraT": "",
			"PuntoEncuentroT": "",
			"SalidaT": "",
			"ConductorT": "",
			"TerritorioT": "",
			"HoraN": "",
			"PuntoEncuentroN": "",
			"SalidaN": "",
			"ConductorN": "",
			"TerritorioN": ""
		  },
		  {
			"DiaSemana": "Domingo",
			"Dia": 12,
			"Mes": 10,
			"Anio": 2025,
			"HoraM": "",
			"PuntoEncuentroM": "",
			"SalidaM": "",
			"ConductorM": "",
			"TerritorioM": "",
			"HoraT": "",
			"PuntoEncuentroT": "",
			"SalidaT": "",
			"ConductorT": "",
			"TerritorioT": "",
			"HoraN": "",
			"PuntoEncuentroN": "",
			"SalidaN": "",
			"ConductorN": "",
			"TerritorioN": ""
		  },
		  {
			"DiaSemana": "Lunes",
			"Dia": 13,
			"Mes": 10,
			"Anio": 2025,
			"HoraM": "",
			"PuntoEncuentroM": "",
			"SalidaM": "",
			"ConductorM": "",
			"TerritorioM": "",
			"HoraT": "18:00",
			"PuntoEncuentroT": "Zoom",
			"SalidaT": "Congregacional",
			"ConductorT": "Natalia Calderon",
			"TerritorioT": "",
			"HoraN": "",
			"PuntoEncuentroN": "",
			"SalidaN": "",
			"ConductorN": "",
			"TerritorioN": ""
		  },
		  {
			"DiaSemana": "Martes",
			"Dia": 14,
			"Mes": 10,
			"Anio": 2025,
			"HoraM": "09:30",
			"PuntoEncuentroM": "Curupaiti y Castro",
			"SalidaM": "Congregacional",
			"ConductorM": "Jose Ortiz",
			"TerritorioM": 30,
			"HoraT": "18:00",
			"PuntoEncuentroT": "Curupaiti y Castro",
			"SalidaT": "Congregacional",
			"ConductorT": "Carlos Caba�ez",
			"TerritorioT": 31,
			"HoraN": "",
			"PuntoEncuentroN": "",
			"SalidaN": "",
			"ConductorN": "",
			"TerritorioN": ""
		  },
		  {
			"DiaSemana": "Miercoles",
			"Dia": 15,
			"Mes": 10,
			"Anio": 2025,
			"HoraM": "09:30",
			"PuntoEncuentroM": "Curupaiti y Elpidio Gonzalez",
			"SalidaM": "Congregacional",
			"ConductorM": "Hector Ortiz",
			"TerritorioM": 22,
			"HoraT": "18:00",
			"PuntoEncuentroT": "Tapon Moyano y San Francisco del Monte",
			"SalidaT": "Congregacional",
			"ConductorT": "Roberto Garcia",
			"TerritorioT": 7,
			"HoraN": "",
			"PuntoEncuentroN": "",
			"SalidaN": "",
			"ConductorN": "",
			"TerritorioN": ""
		  },
		  {
			"DiaSemana": "Jueves",
			"Dia": 16,
			"Mes": 10,
			"Anio": 2025,
			"HoraM": "09:30",
			"PuntoEncuentroM": "Zoom",
			"SalidaM": "Congregacional",
			"ConductorM": "Emanuel Gualpa",
			"TerritorioM": "",
			"HoraT": "",
			"PuntoEncuentroT": "",
			"SalidaT": "",
			"ConductorT": "",
			"TerritorioT": "",
			"HoraN": "",
			"PuntoEncuentroN": "",
			"SalidaN": "",
			"ConductorN": "",
			"TerritorioN": ""
		  },
		  {
			"DiaSemana": "Viernes",
			"Dia": 17,
			"Mes": 10,
			"Anio": 2025,
			"HoraM": "09:30",
			"PuntoEncuentroM": "Curupaiti y Castro",
			"SalidaM": "Congregacional",
			"ConductorM": "Oscar Galdames",
			"TerritorioM": 28,
			"HoraT": "18:00",
			"PuntoEncuentroT": "Curupaiti y Castro",
			"SalidaT": "Congregacional",
			"ConductorT": "Cristian Bringas",
			"TerritorioT": 32,
			"HoraN": "20:00",
			"PuntoEncuentroN": "Zoom",
			"SalidaN": "Congregacional",
			"ConductorN": "Emanuel Gualpa",
			"TerritorioN": ""
		  },
		  {
			"DiaSemana": "Sabado",
			"Dia": 18,
			"Mes": 10,
			"Anio": 2025,
			"HoraM": "09:30",
			"PuntoEncuentroM": "Jose Quiroga",
			"SalidaM": "Grupo 1",
			"ConductorM": "Roque Castillo",
			"TerritorioM": 5,
			"HoraT": "18:00",
			"PuntoEncuentroT": "Hector Ortiz",
			"SalidaT": "Grupo 2",
			"ConductorT": "Mauricio Godoy",
			"TerritorioT": 9,
			"HoraN": "",
			"PuntoEncuentroN": "",
			"SalidaN": "",
			"ConductorN": "",
			"TerritorioN": ""
		  },
		  {
			"DiaSemana": "Sabado",
			"Dia": 18,
			"Mes": 10,
			"Anio": 2025,
			"HoraM": "09:30",
			"PuntoEncuentroM": "Candia",
			"SalidaM": "Grupo 3",
			"ConductorM": "Jonatan Astudillo",
			"TerritorioM": 15,
			"HoraT": "18:00",
			"PuntoEncuentroT": "Tapon Moyano y Boulevard",
			"SalidaT": "Congregacional",
			"ConductorT": "Carlos Caba�ez",
			"TerritorioT": 3,
			"HoraN": "",
			"PuntoEncuentroN": "",
			"SalidaN": "",
			"ConductorN": "",
			"TerritorioN": ""
		  },
		  {
			"DiaSemana": "Sabado",
			"Dia": 18,
			"Mes": 10,
			"Anio": 2025,
			"HoraM": "09:30",
			"PuntoEncuentroM": "Centro de Salud",
			"SalidaM": "Grupo 4",
			"ConductorM": "Gustavo Miron",
			"TerritorioM": 11,
			"HoraT": "",
			"PuntoEncuentroT": "",
			"SalidaT": "",
			"ConductorT": "",
			"TerritorioT": "",
			"HoraN": "",
			"PuntoEncuentroN": "",
			"SalidaN": "",
			"ConductorN": "",
			"TerritorioN": ""
		  },
		  {
			"DiaSemana": "Domingo",
			"Dia": 19,
			"Mes": 10,
			"Anio": 2025,
			"HoraM": "",
			"PuntoEncuentroM": "",
			"SalidaM": "",
			"ConductorM": "",
			"TerritorioM": "",
			"HoraT": "",
			"PuntoEncuentroT": "",
			"SalidaT": "",
			"ConductorT": "",
			"TerritorioT": "",
			"HoraN": "",
			"PuntoEncuentroN": "",
			"SalidaN": "",
			"ConductorN": "",
			"TerritorioN": ""
		  },
		  {
			"DiaSemana": "Lunes",
			"Dia": 20,
			"Mes": 10,
			"Anio": 2025,
			"HoraM": "",
			"PuntoEncuentroM": "",
			"SalidaM": "",
			"ConductorM": "",
			"TerritorioM": "",
			"HoraT": "18:00",
			"PuntoEncuentroT": "Zoom",
			"SalidaT": "Congregacional",
			"ConductorT": "Emanuel Gualpa",
			"TerritorioT": "",
			"HoraN": "",
			"PuntoEncuentroN": "",
			"SalidaN": "",
			"ConductorN": "",
			"TerritorioN": ""
		  },
		  {
			"DiaSemana": "Martes",
			"Dia": 21,
			"Mes": 10,
			"Anio": 2025,
			"HoraM": "09:30",
			"PuntoEncuentroM": "Centro de Salud",
			"SalidaM": "Congregacional",
			"ConductorM": "Jose Ortiz",
			"TerritorioM": 13,
			"HoraT": "18:00",
			"PuntoEncuentroT": "Pedro Goyena y Tapon Moyano",
			"SalidaT": "Congregacional",
			"ConductorT": "Carlos Caba�ez",
			"TerritorioT": 5,
			"HoraN": "",
			"PuntoEncuentroN": "",
			"SalidaN": "",
			"ConductorN": "",
			"TerritorioN": ""
		  },
		  {
			"DiaSemana": "Miercoles",
			"Dia": 22,
			"Mes": 10,
			"Anio": 2025,
			"HoraM": "09:30",
			"PuntoEncuentroM": "Gutierrez",
			"SalidaM": "Congregacional",
			"ConductorM": "Oscar Galdames",
			"TerritorioM": 18,
			"HoraT": "18:00",
			"PuntoEncuentroT": "Reyes",
			"SalidaT": "Congregacional",
			"ConductorT": "Roberto Garcia",
			"TerritorioT": 14,
			"HoraN": "",
			"PuntoEncuentroN": "",
			"SalidaN": "",
			"ConductorN": "",
			"TerritorioN": ""
		  },
		  {
			"DiaSemana": "Jueves",
			"Dia": 23,
			"Mes": 10,
			"Anio": 2025,
			"HoraM": "09:30",
			"PuntoEncuentroM": "Zoom",
			"SalidaM": "Congregacional",
			"ConductorM": "Joaquin Rossi",
			"TerritorioM": "",
			"HoraT": "",
			"PuntoEncuentroT": "",
			"SalidaT": "",
			"ConductorT": "",
			"TerritorioT": "",
			"HoraN": "",
			"PuntoEncuentroN": "",
			"SalidaN": "",
			"ConductorN": "",
			"TerritorioN": ""
		  },
		  {
			"DiaSemana": "Viernes",
			"Dia": 24,
			"Mes": 10,
			"Anio": 2025,
			"HoraM": "09:30",
			"PuntoEncuentroM": "Curupaiti y Castro",
			"SalidaM": "Congregacional",
			"ConductorM": "Jose Ortiz",
			"TerritorioM": 21,
			"HoraT": "18:00",
			"PuntoEncuentroT": "Curupaiti y Elpidio Gonzalez",
			"SalidaT": "Congregacional",
			"ConductorT": "Cristian Bringas",
			"TerritorioT": 12,
			"HoraN": "20:00",
			"PuntoEncuentroN": "Zoom",
			"SalidaN": "Congregacional",
			"ConductorN": "Emanuel Gualpa",
			"TerritorioN": ""
		  },
		  {
			"DiaSemana": "Sabado",
			"Dia": 25,
			"Mes": 10,
			"Anio": 2025,
			"HoraM": "09:30",
			"PuntoEncuentroM": "Candia",
			"SalidaM": "Grupos 1 y 3",
			"ConductorM": "Cristian Bringas",
			"TerritorioM": 8,
			"HoraT": "18:00",
			"PuntoEncuentroT": "Pedro Goyena y 9 de Julio",
			"SalidaT": "Congregacional",
			"ConductorT": "Oscar Mu�oz",
			"TerritorioT": 16,
			"HoraN": "",
			"PuntoEncuentroN": "",
			"SalidaN": "",
			"ConductorN": "",
			"TerritorioN": ""
		  },
		  {
			"DiaSemana": "Sabado",
			"Dia": 25,
			"Mes": 10,
			"Anio": 2025,
			"HoraM": "09:30",
			"PuntoEncuentroM": "Tapon Moyano y Boulevard",
			"SalidaM": "Grupos 2 y 4",
			"ConductorM": "Oscar Galdames",
			"TerritorioM": 4,
			"HoraT": "",
			"PuntoEncuentroT": "",
			"SalidaT": "",
			"ConductorT": "",
			"TerritorioT": "",
			"HoraN": "",
			"PuntoEncuentroN": "",
			"SalidaN": "",
			"ConductorN": "",
			"TerritorioN": ""
		  },
		  {
			"DiaSemana": "Domingo",
			"Dia": 26,
			"Mes": 10,
			"Anio": 2025,
			"HoraM": "",
			"PuntoEncuentroM": "",
			"SalidaM": "",
			"ConductorM": "",
			"TerritorioM": "",
			"HoraT": "",
			"PuntoEncuentroT": "",
			"SalidaT": "",
			"ConductorT": "",
			"TerritorioT": "",
			"HoraN": "",
			"PuntoEncuentroN": "",
			"SalidaN": "",
			"ConductorN": "",
			"TerritorioN": ""
		  },
		  {
			"DiaSemana": "Lunes",
			"Dia": 27,
			"Mes": 10,
			"Anio": 2025,
			"HoraM": "",
			"PuntoEncuentroM": "",
			"SalidaM": "",
			"ConductorM": "",
			"TerritorioM": "",
			"HoraT": "18:00",
			"PuntoEncuentroT": "Zoom",
			"SalidaT": "Congregacional",
			"ConductorT": "Noelia Garcia",
			"TerritorioT": "",
			"HoraN": "",
			"PuntoEncuentroN": "",
			"SalidaN": "",
			"ConductorN": "",
			"TerritorioN": ""
		  },
		  {
			"DiaSemana": "Martes",
			"Dia": 28,
			"Mes": 10,
			"Anio": 2025,
			"HoraM": "09:30",
			"PuntoEncuentroM": "Curupaiti y Elpidio Gonzalez",
			"SalidaM": "Congregacional",
			"ConductorM": "Hector Ortiz",
			"TerritorioM": 23,
			"HoraT": "18:00",
			"PuntoEncuentroT": "Reyes",
			"SalidaT": "Congregacional",
			"ConductorT": "Alejandro Videla",
			"TerritorioT": 14,
			"HoraN": "",
			"PuntoEncuentroN": "",
			"SalidaN": "",
			"ConductorN": "",
			"TerritorioN": ""
		  },
		  {
			"DiaSemana": "Miercoles",
			"Dia": 29,
			"Mes": 10,
			"Anio": 2025,
			"HoraM": "09:30",
			"PuntoEncuentroM": "Gutierrez",
			"SalidaM": "Congregacional",
			"ConductorM": "Jose Ortiz",
			"TerritorioM": 18,
			"HoraT": "18:00",
			"PuntoEncuentroT": "Curupaiti y Castro",
			"SalidaT": "Congregacional",
			"ConductorT": "Carlos Caba�ez",
			"TerritorioT": 21,
			"HoraN": "",
			"PuntoEncuentroN": "",
			"SalidaN": "",
			"ConductorN": "",
			"TerritorioN": ""
		  },
		  {
			"DiaSemana": "Jueves",
			"Dia": 30,
			"Mes": 10,
			"Anio": 2025,
			"HoraM": "09:30",
			"PuntoEncuentroM": "Zoom",
			"SalidaM": "Congregacional",
			"ConductorM": "Emanuel Gualpa",
			"TerritorioM": "",
			"HoraT": "",
			"PuntoEncuentroT": "",
			"SalidaT": "",
			"ConductorT": "",
			"TerritorioT": "",
			"HoraN": "",
			"PuntoEncuentroN": "",
			"SalidaN": "",
			"ConductorN": "",
			"TerritorioN": ""
		  },
		  {
			"DiaSemana": "Viernes",
			"Dia": 31,
			"Mes": 10,
			"Anio": 2025,
			"HoraM": "09:30",
			"PuntoEncuentroM": "Pedro Goyena y 9 de Julio",
			"SalidaM": "Congregacional",
			"ConductorM": "Oscar Galdames",
			"TerritorioM": 10,
			"HoraT": "18:00",
			"PuntoEncuentroT": "Centro de Salud",
			"SalidaT": "Congregacional",
			"ConductorT": "Jose Quiroga",
			"TerritorioT": 9,
			"HoraN": "20:00",
			"PuntoEncuentroN": "Zoom",
			"SalidaN": "Congregacional",
			"ConductorN": "Emanuel Gualpa",
			"TerritorioN": ""
		  }
		];
		
		<!--Mapas o capas bases-->
		var osm = new L.tileLayer('http://tile.openstreetmap.org/{z}/{x}/{y}.png', {
			//attribution: '<a style="color:#287404">¿Necesitás ayuda? Tocá las tres líneas de la barra izquierda</a> - Teselas <a href="https://www.openstreetmap.org/" target="blanck">OSM</a> &copy',
			attribution: 'Teselas <a href="https://www.openstreetmap.org/" target="blanck">OSM</a> &copy',
			minZoom: 1
		});
		var googlesatelite = new L.tileLayer('https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', {
			attribution: 'Teselas <a href="https://www.google.com.ar/maps/@-21.5405995,-63.9542602,11544855m/data=!3m1!1e3?entry=ttu" target="blanck">Google Satelital</a> &copy; <a href="javascript:PrepararMail()">Desarrollado por: Mauricio Godoy</a>',
		});
		<!--Selector de las capas base-->
		var CapasBase = {
			"Mapa Callejero": osm,
			"Mapa Satelital": googlesatelite,
		};
		<!--Establecer el área para el mapa y definir cuál será la capa base por defecto-->
		var mapa = L.map('mapa', {editable:true,
			center: ["-32.9238842064728", "-68.77892492536746"],
			zoom: 15,
			layers: [osm],
			zoomControl:false
		});
		L.control.layers(CapasBase).addTo(mapa);
		L.control.zoom({
			position:'topright'}).addTo(mapa);
		<!--Añadir el mini-mapa al lienzo-->
		<!--var worldMiniMap = L.control.worldMiniMap({position: 'bottomright', style: {opacity: 0.9, borderRadius: '0px', backgroundColor: 'lightblue'}}).addTo(mapa);-->
		$('.chosenCasas').chosen({no_results_text: "No se encuentran familias ni publicadores de nombre...",allow_single_deselect: true});
        $(".chosenCasas").chosen().on("chosen:showing_dropdown", function(event) {  
			$(".chosenCasas").trigger('chosen:updated');                                                                           
			});
		var coordenadas="-32.910814909848675, -68.77197721149017".split(",");
		var zum=16;
		var selector_casas=document.createElement('option');
		var listacasas=[];
		var valor="";
		var firstLatLng, secondLatLng;
		var conexion="";
		var circulo="";
		var version="publica";
		var marcador="";
		var seguimiento="no";
		var casa="";
		var casitas="";
		var casas=[];
		var capa_casas={};
		var familia="";
		var ubicacion_real="";
		var borrar_ubicacion_real="";
		var sondeo_posicion=0;
		var senialgps="";
		var lat="";
		var lon="";
		var buscar="territorio";
		var distancia="";
		var lugar="";
		var dentropredio="";
		var nada=L.layerGroup();
		var barrio=null;
		var no_visitar=null;
		var poligono="";
		var capa_infoterritorios={};
		var capa_coloresterritorios={};
		var capa_numerosterritorios={};
		var capa_territoriofiltrado={};
		var capa_territoriofiltradonumero={};
		var puntomascercano=L.latLng[-32.92740232843889, -68.77696838564452];
		var numeroterritorio="";
		var capa_popups=null;
		var infoterritorios=null;
		var infoterritorio=null;
		var orientarme="no";
		var ruta="";
		var actualizarruta="si";
		var coordenadas_ubicacion_real="";
		var icono_posicion = L.icon({iconUrl: './images/posicion.png',iconSize: [35, 40],});
		var tiempomodalflash=20000;
		var temporizadormodalflash="";
		var temporizadornovisitar="";
		var temporizadorpredicado="";
		var mes_anio="";
		var diaseleccionado="";
		var messeleccionado="";
		var anioseleccionado="";
		var fecha="";
		var marcapuntosalida="";
		var cartografiar="congregacion";
		var listaterritorios=[];
		var url_script_territorios=driveterritorios;
		var url_script_novisitar=drivenovisitar;
		
		// Crear grupo de puntos
		var grupomanzanas = L.geoJSON(manzanas, {
			pointToLayer: function(feature, latlng) {
				// Crear un círculo
				const circle = L.circleMarker(latlng, {
					radius: 14,
					fillColor: "#0078ff",
					color: "#fff",
					weight: 2,
					opacity: 1,
					fillOpacity: 0.8
				});
				// Agregar un div centrado con el texto de "manzana"
				const label = L.divIcon({
					className: 'circle-label',
					html: feature.properties.Manzana || '',
					iconSize: [40, 40],
					iconAnchor: [15, 15]
				});
				const labelMarker = L.marker(latlng, {icon: label, interactive: false});
				// Devolver ambos dentro de un grupo
				return L.layerGroup([circle, labelMarker]);
			}
		});

		<!--Añadir la barra lateral-->
		var barralateral = L.control.sidebar('barralateral').addTo(mapa);
		
		const iconosterritorios= L.icon({
			iconUrl: 'images/1.jpg',
			iconSize: [50, 55],
			iconAnchor: [16, 37],
			popupAnchor: [0, -28]
		});
		
		function Contrasenia () {
			var estado=document.getElementById("password").type;
			var valor=document.getElementById("password").value;
			if (estado=="password") {document.getElementById("password").type="text";}
			else {document.getElementById("password").type="password"};
			document.getElementById("password").value = valor;
		};
		
		function Loguearse() {
			usuario=document.getElementsByName("username")[0].value;
			contrasena=document.getElementsByName("password")[0].value;
			if (usuario==usuarios && contrasena==contrasenias) {
				barralateral.close();
				document.getElementById("casas_hnos").style.display='inline';
				document.getElementById("ayuda_usuario").style.display='inline';
				document.getElementById("log_si").style.display='inline';
				document.getElementById("log_no").style.display='none';}
			else {
				document.getElementById("titulo_modalinicial").innerHTML=("<h1>"+"DATOS INCORRECTOS...!!!"+"</h1>");
				document.getElementById("cuerpo_modalinicial").innerHTML=("<h4>"+"El usuario y/o la contraseñas NO son las correctas...!!!"+"</h4>");
				document.getElementById("modal_inicial").showModal();
			};
		};
		
		function CerrarSesion() {
			if (casa) {casa.remove()};
			if (casitas) {casitas.remove()};
			if (ruta) {ruta.remove()};
			if (capa_casas) {mapa.removeLayer(capa_casas)};
			
			
			document.getElementById("casas_hnos").style.display='none';
			document.getElementById("ayuda_usuario").style.display='none';
			document.getElementById("log_si").style.display='none';
			document.getElementById("log_no").style.display='inline';
			document.getElementById("username").value="";
			document.getElementById("password").value="";
			barralateral.close();
		};
		
		<!--Función Mostrar/Habilitar u Ocultar/Deshabilitar elementos según la versión de trabajo-->
		function VerificarVersion() {
			if (version=="publica") {
				document.getElementById("casas_hnos").style.display='none';
				document.getElementById("ayuda_usuario").style.display='none';
				document.getElementById("log_si").style.display='none';
				document.getElementById("log_no").style.display='inline';
			};
			if (version=="completa") {
				document.getElementById("casas_hnos").style.display='inline';
				document.getElementById("ayuda_usuario").style.display='inline';
				document.getElementById("log_si").style.display='inline';
				document.getElementById("log_no").style.display='none';
			};
		};
		
		<!--Función para mapear todas las familias-->
		function VerTodasFlias() {
			barralateral.close();
			if (capa_casas) {mapa.removeLayer(capa_casas)};
			buscar="casa";
			capa_casas = L.geoJson(casasdehnos, {onEachFeature}).addTo(mapa);
			document.getElementById("ocultarflias").style.display="inline";
			document.getElementById("mostrarflias").style.display="none";
		};
		
		<!--Función para mapear todas las familias-->
		function QuitarTodasFlias() {
			capa_casas.remove();
			capa_casas={};
			if (casa !="") {casa.remove()};
			casa="";
			if (casitas !="") {casitas.remove()};
			casitas="";
			casas=[];
			barralateral.close();
			document.getElementById("mostrarflias").style.display="inline";
			document.getElementById("ocultarflias").style.display="none";
		};
		
		<!--Función armado de los Popups de las casas-->
		function Popups_Casas(feature, layer) {
			if (feature.properties && feature.properties.Flia) {
				layer.bindPopup(feature.properties.Flia);
				listacasas.push(feature.properties.Flia)};
		};
		function Popups_Territorios(feature, layer) {
			if (feature.properties && feature.properties.Numero) {
				if (feature.properties.Barrio !==null) {
					var barrio=feature.properties.Barrio}
				else {
					var barrio="Sin información"
				};
				if (feature.properties.No_Visitar !==null) {
					var novisitar=feature.properties.No_Visitar}
				else {
					var novisitar="No hay casas 'NO VISITAR' en este territorio"
				};
				listaterritorios.push(feature.properties.Numero);
				let sinRepetidos = [...new Set(listaterritorios)];
				listaterritorios=sinRepetidos.sort((a, b) => a - b);
				layer.bindPopup("<strong>Territorio Nº "+feature.properties.Numero+"</strong>"+"<br>Barrio: "+barrio+"<br><br><strong>NO VISITAR:</strong><br>"+novisitar);
			};
			//ArmarListaTerritorios();
		};
		
		function NumerosTerritorios(feature, layer) {
			if (feature.properties && feature.properties.Numero) {
				if (feature.properties.Barrio !==null) {
					var barrio=feature.properties.Barrio}
				else {
					var barrio="Sin información"
				};
				if (feature.properties.No_Visitar !==null) {
					var novisitar=feature.properties.No_Visitar}
				else {
					var novisitar="No hay casas 'NO VISITAR' en este territorio"
				};
				var centroide=layer.getBounds().getCenter();
				var coord=[];
				coord.push(centroide.lat,centroide.lng);
				let terri=L.marker(coord,{icon:L.icon({iconUrl: 'images/'+feature.properties.Numero+'.jpg',iconSize: [50, 55],iconAnchor: [16, 37],popupAnchor: [0, -28]}),title:""+feature.properties.Numero})
					.bindPopup("<strong>Territorio Nº "+feature.properties.Numero+"</strong>"+"<br>Barrio: "+barrio+"<br><br><strong>NO VISITAR:</strong><br>"+novisitar);
				nada.addLayer(terri);
				nada.addTo(mapa);
			};
		};
		
		function NumeroTerritorio(feature, layer) {
			if (feature.properties && feature.properties.Numero) {
				if (feature.properties.Barrio !==null) {
					var barrio=feature.properties.Barrio}
				else {
					var barrio="Sin información"
				};
				if (feature.properties.No_Visitar !==null) {
					var novisitar=feature.properties.No_Visitar}
				else {
					var novisitar="No hay casas 'NO VISITAR' en este territorio"
				};
				var centroide=layer.getBounds().getCenter();
				var coord=[];
				coord.push(centroide.lat,centroide.lng);
				numeroterritorio=L.marker(coord,{icon:L.icon({iconUrl: 'images/'+feature.properties.Numero+'.jpg',iconSize: [50, 55],iconAnchor: [16, 37],popupAnchor: [0, -28]}),title:""+feature.properties.Numero})
					.bindPopup("<strong>Territorio Nº "+feature.properties.Numero+"</strong>"+"<br>Barrio: "+barrio+"<br><br><strong>NO VISITAR:</strong><br>"+novisitar).addTo(mapa);
			};
		};
		
		var capa="territorios";
		capa_coloresterritorios = L.geoJson(territorios, {style: PersonalizarPerimetro}).addTo(mapa);
		capa_numerosterritorios = L.geoJson(territorios, {onEachFeature: NumerosTerritorios}).addTo(mapa);
		capa_infoterritorios = L.geoJson(territorios, {style: CapaTransparente, onEachFeature: Popups_Territorios}).addTo(mapa);
		geojson = L.geoJson(casasdehnos, {onEachFeature: Popups_Casas}).addTo(mapa);
		geojson.remove();
		//Capa con Líneas Límites Perimetrales
		limites= L.geoJSON(perimetrolineal, {
			style: {
				color: "orange",
				weight: 6
			},
			onEachFeature: (feature, layer) => {
			const nombre = feature.properties?.Nombre || "Sin nombre";
			const limite=feature.properties?.Limite || "Sin dato";
			// Evento de click para abrir popup en el punto clickeado
			layer.on("click", (e) => {
			L.popup()
			.setLatLng(e.latlng)
			.setContent(`<strong>${nombre}</strong><br>Límite ${limite}`)
			.openOn(mapa);
			});
			}
		}).addTo(mapa);
		listacasas.sort();
		ArmarListaCasas(listacasas);
		
		<!--Función para armar el listado de casas y asignarlo al listbox correspondiente-->
		function ArmarListaCasas(listacasas) {
			var select = document.getElementById('selector_casas');
			var i;
			for (i = 0; i < listacasas.length; i++) {
				var opt = listacasas[i];
				var el = document.createElement("option");
				el.textContent = opt;
				el.value = opt;
				select.appendChild(el);
			};
		};
		
		<!--Función para armar el listado de territorios y asignarlo al listbox correspondiente-->
		function ArmarListaTerritorios() {
			var select = document.getElementById('selector_territorios');
			var i;
			for (i = 0; i < listaterritorios.length; i++) {
				var opt = listaterritorios[i];
				var el = document.createElement("option");
				el.textContent = opt;
				el.value = opt;
				select.appendChild(el);
			};
		};
		
		<!--Función buscar casa elegida-->
		function CasaAbuscar(valor) {
			barralateral.close();
			familia=valor;
			casas.push(familia);
			buscar="casa";
			if (capa_coloresterritorios) {mapa.removeLayer(capa_coloresterritorios)};
			if (capa_numerosterritorios) {mapa.removeLayer(capa_numerosterritorios)};
			if (capa_infoterritorios) {mapa.removeLayer(capa_infoterritorios)};
			if (nada) {mapa.removeLayer(nada)};
			if (capa_territoriofiltrado) {mapa.removeLayer(capa_territoriofiltrado)};
			if (capa_territoriofiltradonumero) {mapa.removeLayer(capa_territoriofiltradonumero)};
			if (numeroterritorio) {mapa.removeLayer(numeroterritorio)};
			if (marcapuntosalida) {marcapuntosalida.remove()};
			if (ruta) {ruta.remove()};
			if (capa_casas) {mapa.removeLayer(capa_casas)};
			capa_casas=L.geoJSON(casasdehnos,{filter:Filtrar_Casas,onEachFeature}).addTo(mapa);
			nada={
				"type": "FeatureCollection",
				"features": casasdehnos.features.filter(f => f.properties.Flia === valor)
			};
			puntomascercano=L.latLng(nada.features[0].geometry.coordinates[0][1],nada.features[0].geometry.coordinates[0][0]);
			cartografiar="casa";
			if (seguimiento==="si") {
				titulomodalflash.innerText="TRAZAR RUTA";
				cuerpomodalflash.innerHTML = '<span style="color:green"><br><b>¿Necesitás ayuda para llegar?.</b><br><br><span style="color:black">Puedo trazarte una ruta '+
				'a partir de tu ubicación actual y brindarte algunas indicaciones.-<br></span>';
				document.getElementById("btn-indicaciones-modal-flash").style.visibility='visible';
				tiempomodalflash=5000;
				ModalFlash(tiempomodalflash);
			};
		};
		
		<!--Función buscar territorio elegido-->
		function TerritorioAbuscar(numeroterritoriobuscado,tipo) {
			valor=Number(numeroterritoriobuscado);
			barralateral.close();
			buscar="territorio";
			if (capa_coloresterritorios) {mapa.removeLayer(capa_coloresterritorios)};
			if (capa_numerosterritorios) {mapa.removeLayer(capa_numerosterritorios)};
			if (capa_infoterritorios) {mapa.removeLayer(capa_infoterritorios)};
			if (nada) {mapa.removeLayer(nada)};
			if (capa_territoriofiltrado) {mapa.removeLayer(capa_territoriofiltrado)};
			if (capa_territoriofiltradonumero) {mapa.removeLayer(capa_territoriofiltradonumero)};
			if (numeroterritorio) {mapa.removeLayer(numeroterritorio)};
			if (marcapuntosalida && ! cartografiar==="salida") {marcapuntosalida.remove()};
			if (capa_casas) {mapa.removeLayer(capa_casas)};
			if (casa) {casa.remove()};
			if (casitas) {casitas.remove()};
			if (ruta) {ruta.remove()};
			capa_territoriofiltrado=L.geoJSON(territorios,{filter:Filtrar_Territorios, style:PersonalizarTerritorioBuscado}).addTo(mapa);
			poligono = {
				"type": "FeatureCollection",
				"features": territorios.features.filter(f => f.properties.Numero === valor)
			};
			if (tipo==="territorio") {
				var centroide=capa_territoriofiltrado.getBounds().getCenter();
				var coord=[];
				coord.push(centroide.lat,centroide.lng);
				mapa.flyTo(coord,16);
				cartografiar="territorio";
				puntomascercano = [centroide.lat, centroide.lng];
			};
			if (tipo==="salida") {
				cartografiar="salida";
			};
			capa_territoriofiltradonumero=L.geoJSON(territorios,{filter:Filtrar_Territorios, onEachFeature: NumeroTerritorio}).addTo(mapa);
			if (capa_infoterritorios) {capa_infoterritorios.addTo(mapa)};
			if (seguimiento==="si") {
				titulomodalflash.innerText="TRAZAR RUTA";
				cuerpomodalflash.innerHTML = '<span style="color:green"><br><b>¿Necesitás ayuda para llegar?.</b><br><br><span style="color:black">Puedo trazarte una ruta '+
				'a partir de tu ubicación actual y brindarte algunas indicaciones.-<br></span>';
				document.getElementById("btn-indicaciones-modal-flash").style.visibility='visible';
				tiempomodalflash=5000;
				ModalFlash(tiempomodalflash);
			};
		};
		
		function Filtrar_Casas(feature) {
			if (capa_casas) {mapa.removeLayer(capa_casas)};
			for (i = 0; i < casas.length; i++) {
				if (feature.properties.Flia==casas[i]) {return true};
			};
			document.getElementById("ocultarflias").style.display="inline";
			document.getElementById("mostrarflias").style.display="inline";
		};
		
		function Filtrar_Territorios(feature) {
			if (valor !="") {if (feature.properties.Numero==valor) return true};
		};
		
		function ColorFondo(d) {
			return (d == 1 || d==9 || d==15 || d==22 || d==29 || d==36 || d==43 || d==50) ? 'red':
			(d== 2 || d==16 || d==30 || d==37 || d==44 || d==51) ? 'blue':
			(d== 3 || d==8 || d==10 || d==13 || d==17 || d==24 || d==31 || d==38 || d==45 || d==52) ? 'yellow':
			(d== 4 || d==11 || d==18 || d==25 || d==32 || d==39 || d==46 || d==53) ? 'pink':
			(d== 5 || d==12 || d==16 || d==19 || d==23 || d==26 || d==33 || d==40 || d==47 || d==54) ? 'cyan':
			(d== 6 || d==13 || d==20 || d==27 || d==34 || d==41 || d==48 || d==55) ? 'green':
			(d== 7 || d==14 || d==21 || d==28 || d==35 || d==42 || d==49 || d==56) ? 'brown':
			'black'
		};

		<!--Funcion para colorear perímetro cultivos/edificios-->
		function ColorPerimetro(d) {
			return d < 100? 'white':
				'black'
		};

		<!--Funcion para llamar subfunciones de coloreo perímetros y áreas-->
		function PersonalizarPerimetro(feature) {
			return {
				fillColor: ColorFondo(feature.properties.Numero),
				weight: 4,
				opacity: 1,
				color: ColorPerimetro(feature.properties.Numero),
				dashArray: '3',
				fillOpacity: 0.3}
		};
		
		//Función para colorear el territorio buscado
		function PersonalizarTerritorioBuscado(feature) {
			return {
				fillColor: "#020259",
				weight: 4,
				opacity: 1,
				color: "#46fafa",
				dashArray: '3',
				fillOpacity: 0.3}
		};
			
		//Función para generar capa transparente con info de cada teritorio
		function CapaTransparente(feature) {
			return {
				interactive: true,          // que respondan a eventos
				color: '#000000',         // borde (da igual el color si es transparente)
				opacity: 0,               // borde 100% transparente
				weight: 2,                // mantener >0 ayuda al hit-test del borde
				fillColor: '#000000',
				fillOpacity: 0.001}        // ~invisible pero clickeable (0 puede dificultar eventos)
		};
		
		//Función para recorrer cada elemento de la capa dada
		function onEachFeature(feature, layer) {
			if (buscar=="territorio") {
				coord_territorio=(feature.geometry.coordinates[0][1]+", "+feature.geometry.coordinates[0][0]).split(",");
				var centroide=layer.getBounds().getCenter();
				var coord=[];
				coord.push(centroide.lat,centroide.lng);
				mapa.flyTo(coord,18);
				if (feature.properties.Barrio !==null) {
					var barrio=feature.properties.Barrio}
				else {
					var barrio="Sin información"
				};
				if (feature.properties.No_Visitar !==null) {
					var novisitar=feature.properties.No_Visitar}
				else {
					var novisitar="No hay casas 'NO VISITAR' en este territorio"
				};
			}
			else {
				var formatoPopup = {
					'maxWidth': '600',
					'className' : 'popups'};
				<!--Establecer la foto del frente de la casa-->
				var nom_foto="";
				nombrefoto=(feature.properties.Flia).split(" ");
				nombrefoto.forEach(nombre => nom_foto=nom_foto+nombre+"_");
				nombrefoto = nom_foto.slice(0, nom_foto.length - 1);
				<!--Establecer qué familias tienen fotos del frente de su casa y cuáles no para distinguir qué imagen mostrar-->
				if (nombrefoto=="Andrada_Liliana" || nombrefoto=="Argüello" || nombrefoto=="Astudillo_Elio-Videla_Alejandro" || nombrefoto=="Astudillo_Jonatan" || nombrefoto=="Battaglia" || nombrefoto=="Biscontin_Irma" || nombrefoto=="Biscontin_Ruben"
				|| nombrefoto=="Bringas" || nombrefoto=="Bustos_Ethel" || nombrefoto=="Cabañez_Carlos" || nombrefoto=="Calderon-Andrada" || nombrefoto=="Candia" || nombrefoto=="Castillo" || nombrefoto=="Cinco-Castillo"
				|| nombrefoto=="Del_Balzo" || nombrefoto=="Ferranti-Ricalde" || nombrefoto=="Figueroa" || nombrefoto=="Galdames" || nombrefoto=="Garcia_Cristian" || nombrefoto=="Garcia_Gonzalo" || nombrefoto=="Garcia_Roberto"
				|| nombrefoto=="Godoy" || nombrefoto=="Gualpa" || nombrefoto=="Huallpa" || nombrefoto=="Leites" || nombrefoto=="Manresa" || nombrefoto=="Miron_Daniel" || nombrefoto=="Miron_Gustavo" || nombrefoto=="Muñoz"
				|| nombrefoto=="Nuñez_Alejandro" || nombrefoto=="Nuñez_Estela" || nombrefoto=="Ortiz_Elias" || nombrefoto=="Ortiz_Hector" || nombrefoto=="Ortiz_Jose" || nombrefoto=="Quiroga_Jose"
				|| nombrefoto=="Quiroga-Ramirez" || nombrefoto=="Reyes" || nombrefoto=="Rossi" || nombrefoto=="Sarmiento" || nombrefoto=="Snieg" || nombrefoto=="Sosa_Noelia" || nombrefoto=="Sosa_Tamara"
				|| nombrefoto=="Vera_Debora" || nombrefoto=="Vera_Natalia") {var foto='./images/'+nombrefoto+".jpg";
				} else {
					var foto='./images/'+'Casa.jpg';
				};
				if (feature.properties.Integrante !=null) {var integrantes=feature.properties.Integrante} else {var integrantes="Sin datos"};
				if (feature.properties.Privilegio !=null) {var privilegios=feature.properties.Privilegio} else {var privilegios="Sin datos"};
				if (feature.properties.Direccion !=null) {var direccion=feature.properties.Direccion} else {var direccion="Sin datos"};
				if (feature.properties.Telefono !=null) {var telefono=feature.properties.Telefono} else {var telefono="Sin datos"};
				var contenidoPopup="<img src="+foto+" width='90' height='90' /img><br><strong>Flia. "+feature.properties.Flia+"</strong><br>Integrantes: "+integrantes+"<br>Privilegios: "+privilegios+"<br>Dirección: "+direccion+"<br>Teléfono: "+telefono;
				if (feature.properties.Flia==familia) {
					if (casa !=[]) {casa.remove()};
					coord_casa=(feature.geometry.coordinates[0][1]+", "+feature.geometry.coordinates[0][0]).split(",");
					mapa.flyTo(coord_casa,zum);
					casa=L.marker(coord_casa).addTo(mapa)
						.bindPopup(contenidoPopup)
						.openPopup();
				};
				casitas=layer.bindPopup(contenidoPopup)
					.openPopup();
			};
		};
		
		<!--Verificar Sistema Operativo-->
		function VerificarSistemaOperativo() {
			const userAgent = navigator.userAgent || navigator.vendor || window.opera;
			let so = "Desconocido";
			if (/windows phone/i.test(userAgent)) {
				so = "Windows Phone";
			} else if (/win/i.test(userAgent)) {
				so = "Windows";
			} else if (/android/i.test(userAgent)) {
				so = "Android";
			} else if (/ipad|iphone|ipod/i.test(userAgent)) {
				so = "iOS (iPad o iPhone)";
			} else if (/mac/i.test(userAgent)) {
				so = "MacOS";
			} else if (/linux/i.test(userAgent)) {
				so = "Linux";
			};
			sistema_operativo=so;
			if (so=="Windows" || so=="Linux") {document.getElementById("botonnorte").style.visibility="visible"};
		};
		
		<!--Funcion para verificar estado de conectividad-->
		function VerificarConexion() {
			const online = navigator.onLine;
			online ? conexion="si" : conexion="no";
			if (conexion=="no") {
				titulomodalflash.innerText="SIN CONEXION";
				cuerpomodalflash.innerHTML = '<span style="color:red"><br><b>No hay conexión a interntet.</b><br><br><span style="color:black">Por favor, busca la manera de conectarte para poder usar este visor web.</span>';
				tiempomodalflash=4000;
				ModalFlash(tiempomodalflash);
			};
		};

		<!--Función para verificar GPS-->
		function VerificarGPS() {
			<!--Sin GPS-->
			if (!navigator.geolocation) {
				titulomodalflash.innerText="SIN GPS";
				cuerpomodalflash.innerHTML = '<span style="color:red"><br><b>Oho...!!!.</b><br><br><span style="color:black">Parece que tu navegador o dispositivo no funciona con GPS...!!!.-<br>'+
				'Por lo tanto, no podrás ver tu ubicación en tiempo real.</span>';
				tiempomodalflash=5000;
				ModalFlash(tiempomodalflash);
				senialgps="no";
			};
			if (!sistema_operativo==="Windows" && !sistema_operativo==="MacOS" && !sistema_operativo==="Linux") {navigator.geolocation.getCurrentPosition(
				<!--GPS Perfecto-->
				(pos) => {
					senialgps="si";
					const lat = pos.coords.latitude.toFixed(6);
					const lon = pos.coords.longitude.toFixed(6);
					const accuracy = pos.coords.accuracy;
					//alert(`✅ GPS activo\nLatitud: ${lat}\nLongitud: ${lon}\nPrecisión: ${accuracy} metros`+pos.coords.latitude+pos.coords.longitude);
					//MarcarUbicacion(pos);
				},
				<!--Algún problema con el GPS-->
				(error) => {
					senialgps="no";
					msg="❌ No se pudo acceder al GPS";
					if (error.code === 1) msg1 = "❌ Permiso de ubicación denegado";
					else if (error.code === 2) msg1 = "❌ Posición no disponible";
					else if (error.code === 3) msg1 = "❌ Tiempo de espera agotado";
					titulomodalflash.innerText="SIN GPS";
					cuerpomodalflash.innerHTML = '<span style="color:red"><br><b>Oho...!!!.</b><br><br><span style="color:black">'+msg+'...!!!.-<br>'+
					'Debido a: '+msg1+'.-</span>';
					tiempomodalflash=5000;
					ModalFlash(tiempomodalflash);
				},
				{
					enableHighAccuracy: true,
					timeout: 5000,
					maximumAge: 0
				}
			)};
		};
		
		function activar_seguimiento() {
			sondeo_posicion=0;
			barralateral.close();
			document.getElementById("gps").src="./images/slide_on.jpg";
			document.getElementById("activargps").style.visibility='hidden';
			document.getElementById("ubicacion_estado").href="javascript:desactivar_seguimiento()";
			VerificarConexion();
			if (conexion==="si") {
				VerificarGPS();
				if ((sistema_operativo=="Windows" || sistema_operativo=="Linux" || sistema_operativo=="MacOS") && seguimiento=="no") {
					titulomodalflash.innerText="TRAZAR RUTA";
					cuerpomodalflash.innerHTML = '<span style="color:red"><br><b>Puede que la ubicación que te muestre NO SEA LA REAL.</b><br><br><span style="color:black">Parece que estás conectado desde una PC; por lo que la ubicación tal vez sea la de tu proveedor de internet; en vez del lugar donde estás.-<br></span>';
					document.getElementById("btn-indicaciones-modal-flash").style.visibility='hidden';
					tiempomodalflash=9000;
					ModalFlash(tiempomodalflash);
				};
				seguimiento="si";
				document.getElementById("botoncentrado").style.visibility='visible';
				mapa.locate({setView: false, watch: true, enableHighAccuracy: true});
				mapa.on('locationfound', ActualizarUbicacion);
				mapa.on('locationerror', ErrorGPS);
			};
		};

		// Evento al encontrar la ubicación
		function ActualizarUbicacion(e) {
			if (coordenadas_ubicacion_real) {
				mapa.removeLayer(marca_ubicacion_real);
				marca_ubicacion_real = L.marker(e.latlng,{icon:icono_posicion}).addTo(mapa)
					.bindPopup("Vas por aquí");
				coordenadas_ubicacion_real=e.latlng;
			};
			if (!coordenadas_ubicacion_real) {
				marca_ubicacion_real = L.marker(e.latlng,{icon:icono_posicion}).addTo(mapa)
					.bindPopup("Estás por aquí")
					.openPopup();
				coordenadas_ubicacion_real=e.latlng;
				mapa.setView(coordenadas_ubicacion_real, 17);
			};
			distancia=DistanciaEnTiempoReal();
			const dentro = ChequearPredio(coordenadas_ubicacion_real);//{lat:"-32.92738990461459", lng:"-68.77720752661189"});//coordenadas_ubicacion_real);
			if (!dentro || dentro==null) {
				dentropredio=""} else {dentropredio="si"};
			//if (dentropredio=="si") {alert("Estás dentro del teritorio")};
			//if (distancia>2200 && orientarme=="no") {
			if (orientarme=="no" && dentropredio=="") {
				titulomodalflash.innerText="TRAZAR RUTA";
				cuerpomodalflash.innerHTML = '<span style="color:green"><br><b>¿Necesitás ayuda para llegar?.</b><br><br><span style="color:black">Puedo trazarte una ruta '+
				'a partir de tu ubicación actual y brindarte algunas indicaciones.-<br></span>';
				document.getElementById("btn-indicaciones-modal-flash").style.visibility='visible';
				tiempomodalflash=5000;
				ModalFlash(tiempomodalflash);
			};
			//if (distancia<=2200 && distancia>7 && orientarme=="no") {
			if (orientarme=="no" && dentropredio=="si" && distancia>7) {
				titulomodalflash.innerText="TRAZAR RUTA";
				cuerpomodalflash.innerHTML = '<span style="color:green"><br><b>¿Necesitás ayuda para llegar?.</b><br><br><span style="color:black">Puedo mostrarte en tiempo real por dónde vas '+
				'y el destino con vista de ambos puntos en el mapa.-<br></span>';
				document.getElementById("btn-indicaciones-modal-flash").style.visibility='visible';
				tiempomodalflash=5000;
				ModalFlash(tiempomodalflash);
			};
			//if (orientarme=="si" && distancia>1100) {cajadistancia.style.visibility="visible"};
			//if (orientarme=="si" && capa_territoriofiltradonumero) {cajadistancia.style.visibility="visible"};
			if (orientarme=="si" && (dentropredio=="" || capa_territoriofiltrado)) {cajadistancia.style.visibility="visible"};
			if (distancia > 7 && orientarme=="si") {
				cajadistancia.style.visibility="visible";
				if (distancia>6000) {msg="¡Estás a unos "+(Math.round(distancia/1000).toString().replace(/\B(?=(\d{3})+(?!\d))/g, "."))+" kilómetros del destino! (En línea recta).-"};
				if (distancia<6001) {msg="¡Estás a unos "+(Math.round(distancia).toString().replace(/\B(?=(\d{3})+(?!\d))/g, "."))+" metros del destino! (En línea recta).-"};
				cajadistancia.textContent = msg;
				cajadistancia.style.background = "#d4edda";
				cajadistancia.style.color = "#155724";
			};
			if (distancia <= 7 && orientarme=="si") {
				cajadistancia.style.visibility="visible";
				cajadistancia.textContent = "¡Has llegado a tu destino!";
				cajadistancia.style.background = "#d4edda";
				cajadistancia.style.color = "#155724";
				if (avisollegada==="si") {AlertaLlegada("Has llegado a tu destino")};
			};
		};

		// Evento en caso de error
		function ErrorGPS(e) {
			if (!sistema_operativo=="Windows" && !sistema_operativo=="Linux") {
				cajadistancia.textContent = "No se pudo obtener la ubicación: " + e.message;
				cajadistancia.style.color = "red";
			};
		};
		
		//Anuncio en voz alta de cercanía/llegada a destino
		function AlertaLlegada(msg) {
			const utterance = new SpeechSynthesisUtterance(msg);
			speechSynthesis.speak(utterance);
			avisollegada="no";
			orientarme="no";
			clearTimeout(temporizadormodalflash);
		};
		
		function DistanciaEnTiempoReal() {
			if (cartografiar==="salida") {
				const destino=L.latLng(puntomascercano[0], puntomascercano[1]);
				const minDistance=coordenadas_ubicacion_real.distanceTo(destino);
				return minDistance;
			};
			if (cartografiar==="casa") {
				const minDistance=coordenadas_ubicacion_real.distanceTo(puntomascercano);
				return minDistance;
			};
			const point = turf.point([coordenadas_ubicacion_real.lng, coordenadas_ubicacion_real.lat]);
			if (cartografiar==="congregacion" || cartografiar==="territorio") {
				const lineSegments = [];
				if (cartografiar==="territorio") {var coords = poligono.features[0].geometry.coordinates[0][0]};
				if (cartografiar==="congregacion") {var coords = perimetro.features[0].geometry.coordinates[0][0]};
				for (let i = 0; i < coords.length - 1; i++) {
					lineSegments.push(turf.lineString([coords[i], coords[i + 1]]));
				};
				let minDistance = Infinity;
				let nearestPoint = null;
				let nearestSegment = null;
				lineSegments.forEach(segment => {
					const snapped = turf.nearestPointOnLine(segment, point);
					const dist = turf.distance(point, snapped, {units: 'meters'});
					if (dist < minDistance) {
						minDistance = dist;
						nearestPoint = snapped;
						nearestSegment = segment;
					};
				});
				puntomascercano= [nearestPoint.geometry.coordinates[1], nearestPoint.geometry.coordinates[0]];
				return minDistance;
			};
		};
		
		function ChequearPredio(coords) {
			const pt = turf.point([coords.lng, coords.lat]);
			let found = null;
			for (const f of perimetro.features) {
				if (["Polygon", "MultiPolygon"].includes(f.geometry.type)) {
					if (turf.booleanPointInPolygon(pt, f)) {
						found = f;
						break;
					}
				}
			}
			return found;
		};
		
		// Función para detener geolocalización
		function DetenerActualizarUbicacion() {
			orientarme="no";
			clearInterval(actualizarruta);
			actualizarruta="si";
			titulomodalflash.innerText="SEGUIMIENTO DETENIDO";
			cuerpomodalflash.innerHTML = '<span style="color:red"><br><b>Se cancelará la actualización del trazado de ruta.</b><br><br><span style="color:black">porque apagaste el GPS.-</span>';
			tiempomodalflash=5000;
			ModalFlash(tiempomodalflash);
			//document.getElementById("dondestoy").style.visibility='hidden';
			coordenadas_ubicacion_real="";
			distancia="";
			mapa.stopLocate();
			mapa.off('locationfound', ActualizarUbicacion);
			mapa.off('locationerror', ErrorGPS);
			if (marca_ubicacion_real) {
				mapa.removeLayer(marca_ubicacion_real);
				coordenadas_ubicacion_real = "";
				marca_ubicacion_real = "";
			};
			titulomodalflash.innerText="SEGUIMIENTO DETENIDO";
			cuerpomodalflash.innerHTML = '<span style="display: block; text-align: center; width: 100%; color:green;"><br><b>Servicio de seguimiento en tiempo real detenido.</b><br><br><span style="color:black">'+
			'No podrás visualizar tu posición ni recibir indicaciones para llegar a un lugar.'+
			'<br><br>Podrás volver a activarla en el momento que lo desees.</span>';
			tiempomodalflash=5000;
			ModalFlash(tiempomodalflash);
		};

		<!--Función para Centrar en Mi Ubicación Actual-->
		function CentrarMiUbicacion() {
			barralateral.close();
			mapa.setView(coordenadas_ubicacion_real, 17);
		};

		<!--Función para detener el seguimiento en tiempo real-->
		function desactivar_seguimiento() {
			barralateral.close();
			seguimiento="no";
			avisollegada="";
			dentropredio="";
			document.getElementById("gps").src="./images/slide_off.jpg";
			//document.getElementById("gpson").style.visibility='hidden';
			//document.getElementById("gpsoff").style.visibility='visible';
			document.getElementById("botoncentrado").style.visibility='hidden';
			document.getElementById("activargps").style.visibility='visible';
			cajadistancia.style.visibility="hidden";
			//document.getElementById("dondestoy").style.visibility='hidden';
			document.getElementById("ubicacion_estado").href="javascript:activar_seguimiento()";
			DetenerActualizarUbicacion();
			if (marca_ubicacion_real) {mapa.removeLayer(marca_ubicacion_real)};
			marca_ubicacion_real="";
			coordenadas_ubicacion_real="";
			if (ruta) {ruta.remove()};
			if (marcapuntosalida) {marcapuntosalida.remove()};
			mapa.flyTo([-32.9238842064728, -68.77892492536746],15);
		};

		<!--Función para Trazar Ruta Sugerida con OSRM-->
		function TrazarRuta() {
			VerificarConexion();
			if (conexion==="si") {
				VerificarGPS();
			};
			avisollegada="si";
			if (ruta) {ruta.remove()};
			document.getElementById("btn-indicaciones-modal-flash").style.visibility='hidden';
			document.getElementById("MiModalFlash").style.visibility='hidden';
			distancia=DistanciaEnTiempoReal();
			const dentro = ChequearPredio(coordenadas_ubicacion_real);//{lat:"-32.92738990461459", lng:"-68.77720752661189"});//coordenadas_ubicacion_real);
			if (!dentro || dentro==null) {
				dentropredio=""} else {dentropredio="si"};
			//if (dentropredio=="si") {alert("Estás dentro del teritorio")};
			if (orientarme=="si" && (dentropredio=="" || capa_territoriofiltrado)) {cajadistancia.style.visibility="visible"};
			if (distancia>6000) {msg="¡Estás a unos "+(Math.round(distancia/1000).toString().replace(/\B(?=(\d{3})+(?!\d))/g, "."))+" kilómetros del destino! (En línea recta).-"};
			if (distancia<6001) {msg="¡Estás a unos "+(Math.round(distancia).toString().replace(/\B(?=(\d{3})+(?!\d))/g, "."))+" metros del destino! (En línea recta).-"};
			cajadistancia.textContent = msg;
			cajadistancia.style.background = "#d4edda";
			cajadistancia.style.color = "#155724";
			if (distancia<=2200 && lugar) {
				if (ruta) {ruta.remove()};
				clearInterval(actualizarruta);
				ActualizarUbicacion();
			};
			if (distancia>2200) {
				ruta=L.Routing.control({
					waypoints: [coordenadas_ubicacion_real, puntomascercano],
					router: L.Routing.osrmv1({
						serviceUrl: 'https://router.project-osrm.org/route/v1',
						language: 'es',
					}),
					showAlternatives: true,
					routeWhileDragging: true,
					draggableWaypoints: false,
					collapsible: true,
					waypointMode: 'snap',
					lineOptions: {styles: [{color: 'red', opacity: 0.6, weight: 6}]},
					altLineOptions: {styles: [{color: 'blue', opacity: 0.5, weight: 4}]},
					createMarker: function(i, wp) {
						return L.marker(wp.latLng, {
							draggable: false,
							icon: L.icon({
								iconUrl: './images/posicion.png',
								iconSize: [0, 0]
							})
						});
					}
				}).addTo(mapa);
				//Centrar el mapa para que se vean ubicación en tiempo real y EEA ó Sector/Persona buscado **SOLO la primera vez**
				if (actualizarruta=="si") {const centrar = L.latLngBounds(coordenadas_ubicacion_real, puntomascercano);mapa.fitBounds(centrar, {padding: [50, 50]});};
				//const osrmUrl = `https://router.project-osrm.org/route/v1/driving/${coordenadas_ubicacion_real.lng},${coordenadas_ubicacion_real.lat};${puntomascercano.lng},${puntomascercano.lat}?overview=full&geometries=geojson`;
				//Solicito la ruta y la dibujo con animación
				//fetch(osrmUrl)
				//	.then(response => response.json())
				//	.then(data => {
				//		if (data.routes && data.routes.length > 0) {
				//			const route = data.routes[0].geometry;
				//			// Convertimos las coordenadas de GeoJSON a un formato que Leaflet entienda
				//			const latlngs = route.coordinates.map(coord => [coord[1], coord[0]]);
				//		};
				//	})
				//	.catch(error => {
				//		titulomodalflash.innerText="PROBLEMAS PARA SUGERIR UNA RUTA";
				//		cuerpomodalflash.innerHTML = '<span style="color:red"><br><b>El servidor de OSRM no puede sugerirte una ruta en este momento.-</span>';
				//		tiempomodalflash=5000;
				//		ModalFlash(tiempomodalflash);
				//	});
					
				actualizarruta=setInterval(()=>{
					if (ruta) {ruta.remove()};
					ruta=L.Routing.control({
					waypoints: [coordenadas_ubicacion_real, puntomascercano],
					router: L.Routing.osrmv1({
						serviceUrl: 'https://router.project-osrm.org/route/v1',
						language: 'es',
					}),
					showAlternatives: true,
					routeWhileDragging: true,
					draggableWaypoints: false,
					collapsible: true,
					waypointMode: 'snap',
					lineOptions: {styles: [{color: 'red', opacity: 0.6, weight: 6}]},
					altLineOptions: {styles: [{color: 'blue', opacity: 0.5, weight: 4}]},
					createMarker: function(i, wp) {
						return L.marker(wp.latLng, {
							draggable: false,
							icon: L.icon({
								iconUrl: './images/posicion.png',
								iconSize: [0, 0]
							})
						});
					}
					}).addTo(mapa);
					//const osrmUrl = `https://router.project-osrm.org/route/v1/driving/${coordenadas_ubicacion_real.lng},${coordenadas_ubicacion_real.lat};${puntomascercano.lng},${puntomascercano.lat}?overview=full&geometries=geojson`;
					//Solicito la ruta y la dibujo con animación
					//fetch(osrmUrl)
					//	.then(response => response.json())
					//	.then(data => {
					//		if (data.routes && data.routes.length > 0) {
					//			const route = data.routes[0].geometry;
					//			// Convertimos las coordenadas de GeoJSON a un formato que Leaflet entienda
					//			const latlngs = route.coordinates.map(coord => [coord[1], coord[0]]);
					//		};
					//	})
					//	.catch(error => {
					//		titulomodalflash.innerText="PROBLEMAS PARA SUGERIR UNA RUTA";
					//		cuerpomodalflash.innerHTML = '<span style="color:red"><br><b>El servidor de OSRM no puede sugerirte una ruta en este momento.-</span>';
					//		tiempomodalflash=5000;
					//		ModalFlash(tiempomodalflash);
					//	});
				},300000);
			};
		};
	
		//Bloque Modal Flash
		function ModalFlash(tiempo) {
			document.getElementById("MiModalFlash").style.visibility='visible';
			let intervalo;
			let timeout;
			let restante = tiempo/1000;
			document.getElementById('contador').textContent = restante;
			intervalo = setInterval(() => {
				restante--;
				document.getElementById('contador').textContent = restante;
				if (restante <= 0) clearInterval(intervalo);
				}, 1000);
			temporizadormodalflash=setTimeout(() => {
				document.getElementById("btn-indicaciones-modal-flash").style.visibility='hidden';
				document.getElementById("MiModalFlash").style.visibility='hidden';
				//if (mail=="si") {EnviarMail()};
			}, tiempo);
		};
		
		document.getElementById("casas_hnos").style.display='none';
		document.getElementById("ayuda_usuario").style.display='none';
		document.getElementById("log_si").style.display='none';
		document.getElementById("ocultarflias").style.display="none";
		document.getElementById("localizacion").style.display='none';
		
		if (conexion=="no") {
			document.getElementById("Conectividad").style.display="inline";
		} else {
			document.getElementById("Conectividad").style.display="none";
		};

		if (! navigator.userAgent.match(/Windows/i) && localStorage.getItem('MOSTRAR_CELULAR') !=="no") {
			document.getElementById("modal_inicial").showModal()
		} else {
			if (conexion=="no") {document.getElementById("Conectividad").style.display="inline"; document.getElementById("Apaisado").style.display="none";document.getElementById("modal_inicial").showModal();}
		};

		//Capturar evento sobre botones
		const btncerrarmodalflash=document.querySelector("#btn-cerrar-modal-flash");
		btncerrarmodalflash.addEventListener("click",()=>{
			document.getElementById("btn-indicaciones-modal-flash").style.visibility='hidden';
			document.getElementById("MiModalFlash").style.visibility='hidden';
			if (nomostrarinicial.checked) {
				try {
					localStorage.setItem('MOSTRAR_INICIAL', 1);
				} catch(e){
					// ignore storage errors
					console.warn('No se pudo guardar preferencia en localStorage', e);
				}
			};
			orientarme="no";
			avisollegada="no";
			clearTimeout(temporizadormodalflash);
			tiempomodalflash=5000;
		});
		const btnindicacionesmodalflash=document.querySelector("#btn-indicaciones-modal-flash");
		btnindicacionesmodalflash.addEventListener("click",()=>{
			clearTimeout(temporizadormodalflash);
			orientarme="si";
			avisollegada="si";
			activar_seguimiento();
		});
		const cajadistancia = document.getElementById("distancia");
		const btncerrarmodalinicial=document.querySelector("#btn-cerrar-modal-inicial");
		const modalinicial=document.querySelector("#modal_inicial");
		btncerrarmodalinicial.addEventListener("click",()=>{
			if (nomostrarcelular.checked) {
				try {
					localStorage.setItem('MOSTRAR_CELULAR', 'no');
				} catch(e){
					// ignore storage errors
					console.warn('No se pudo guardar preferencia en localStorage', e);
				}
			};
			modalinicial.close()
		});
		
		//Bloque para el Calendario
		// ==== 2) Estado y helpers ====
		const borrarfecha = document.getElementById('BorrarFecha');
		const titulocalendario = document.getElementById('TituloCalendario');
		const diasdelasemanaEl = document.getElementById('diasdelasemana');
		const diasEl = document.getElementById('dias');

		let fechaISO = null; // Fecha seleccionada en formato ISO (YYYY-MM-DD)

		// Utilidades de fecha
		const hoydia = new Date();
		const anio = hoydia.getFullYear();
		const mes = hoydia.getMonth(); // 0-11

		const nombresmeses = ['enero','febrero','marzo','abril','mayo','junio','julio','agosto','septiembre','octubre','noviembre','diciembre'];
		const nombresdiasdelasemana = ['L','M','X','J','V','S','D'];

		// ==== 3) Construir cabecera y semana ====
		function ArmarSemanas(){
			diasdelasemanaEl.innerHTML = '';
			nombresdiasdelasemana.forEach(w => {
				const el = document.createElement('div');
				el.className = 'calendario-semana';
				el.textContent = w;
				diasdelasemanaEl.appendChild(el);
			});
		};

		function pad(n){ return String(n).padStart(2,'0'); }
		function formatoISO(y,m,d){ return `${y}-${pad(m+1)}-${pad(d)}`; }
		function formatoHumano(d,m,y){ return `${pad(d)}/${pad(m+1)}/${y}`; }

		// ==== 4) Construir el calendario SOLO del mes actual ====
		function ArmarCalendario(){
			let fechia = new Date();
			let opciones = { month: 'long' };
			let anioi = fechia.getFullYear();
			let mesi = fechia.toLocaleDateString('es-ES', opciones);
			let nombremes=mesi.charAt(0).toUpperCase() + mesi.slice(1);
			titulocalendario.textContent = nombremes+" "+anioi;
			mes_anio= `${nombresmeses[mes]} ${anio}`;
			diasEl.innerHTML = '';

			// Primer día del mes (ajustado para que la semana empiece Lunes)
			const first = new Date(anio, mes, 1);
			const firstWeekday = (first.getDay() + 6) % 7; // 0=Lunes ... 6=Domingo

			const last = new Date(anio, mes + 1, 0);
			const totalDays = last.getDate();

			// Relleno vacío antes del 1
			for (let i=0; i<firstWeekday; i++){
				const empty = document.createElement('div');
				empty.className = 'calendario-dia';
				empty.setAttribute('aria-disabled','true');
				empty.textContent = '';
				diasEl.appendChild(empty);
			}

			// Días del mes
			for (let d=1; d<=totalDays; d++){
				const btn = document.createElement('button');
				btn.type = 'button';
				btn.className = 'calendario-dia';
				btn.textContent = d;
				const hoy = (d === hoydia.getDate());
				if (hoy) btn.classList.add('hoydia');
				const iso = formatoISO(d, mes, anio);
				btn.dataset.iso = iso;
				btn.title = `Seleccionar ${formatoHumano(d, mes, anio)}`;
				btn.addEventListener('click', () => {
					// Quitar selección previa
					diasEl.querySelectorAll('.calendario-dia.selected').forEach(el=>el.classList.remove('selected'));
					btn.classList.add('selected');
					fechaISO = iso;
					const ev = new CustomEvent('fecha-seleccionada', { detail: { iso, day: d, month: mes+1, anio} });
					window.dispatchEvent(ev);
				});
				diasEl.appendChild(btn);
			};
		};

		// ==== 5) Abrir/Cerrar modal ====
		function AbrirModalCalendario(id) {
			document.getElementById("ModalCalendario").classList.add("active");
			document.getElementById(id).style.display = "block";
			document.getElementById("botonnorte").style.display="none";
			document.getElementById("botonsalidas").style.display="none";
			document.getElementById("botonrecargar").style.display="none";
		};
		
		function CerrarModalCalendario(id) {
			document.getElementById(id).style.display = "none";
			// si no queda ningún modal abierto, cerramos overlay
			const modal1Visible = document.getElementById("modal1").style.display === "block";
			const modal2Visible = document.getElementById("modal2").style.display === "block";
			if (!modal1Visible && !modal2Visible) {
				document.getElementById("ModalCalendario").classList.remove("active");
				document.getElementById("botonnorte").style.display="inline";
				document.getElementById("botonsalidas").style.display="inline";
				document.getElementById("botonrecargar").style.display="inline";
			};
		};

		borrarfecha.addEventListener('click', () => {
			fechaISO = null;
			diasEl.querySelectorAll('.calendario-dia.selected').forEach(el=>el.classList.remove('selected'));
		});

		// ==== 6) Inicializar calendario ====
		ArmarSemanas();
		ArmarCalendario();
		ArmarListaTerritorios();

		// ==== 7) Demostración de captura: escuchar el evento y hacer algo en el mapa ====
		window.addEventListener('fecha-seleccionada', (e) => {
			const { iso } = e.detail;
			document.getElementById('modal2').style.display = "block";
			BuscarSalida(e.detail["day"],e.detail["month"],e.detail["anio"]);
		});
		
		function BuscarSalida(dia,mes,anio) {
			document.getElementById("modal2").classList.add("active");
			const encontrados = salidas.filter(item => item.Dia === (Number(dia)) && item.Mes===(Number(mes)) && item.Anio===(Number(anio)));
			detallessalidas="";
			detallessalidasm="";
			detallessalidast="";
			detallessalidasn="";
			presencial="no";
			vueltam=0;
			vueltat=0;
			vueltan=0;
			if (encontrados.length > 0) {
				encontrados.forEach((objeto, i) => {
					// Recorremos las claves y valores
					for (let clave in objeto) {
						if (clave==="DiaSemana") {fecha="Salidas para el día "+(objeto[clave]);fechita="Salida para el día "+(objeto[clave])};
						if (clave==="Dia") {fecha=fecha+" "+(objeto[clave])+"/";fechita=fechita+" "+(objeto[clave])+"/"};
						if (clave==="Mes") {fecha=fecha+(objeto[clave])+"/";fechita=fechita+(objeto[clave])+"/"};
						if (clave==="Anio") {fecha=fecha+(objeto[clave]);fechita=fechita+(objeto[clave])};
						if (clave==="HoraM" && objeto[clave] !=="") {
							vueltam=vueltam+1;
							if (vueltam===1) {
								salidam1=objeto["PuntoEncuentroM"];
								territoriom1=objeto["TerritorioM"];
								tiposalidam1=objeto["SalidaM"];
								horam1=objeto[clave];
								if (salidam1==="Zoom") {detallessalidasm=detallessalidasm+"La salida por la mañana será a las "+objeto[clave]+" "+objeto["SalidaM"]+" por "+salidam1+". Conductor: "+objeto["ConductorM"]+". Territorio: "+objeto["TerritorioM"]+"."}
								else {presencial="si";detallessalidasm=detallessalidasm+"La salida por la mañana será a las "+objeto[clave]+" "+objeto["SalidaM"]+" desde <a href='#' onclick='PuntoEncuentro(salidam1,territoriom1,fechita,horam1,tiposalidam1)'>"+salidam1+"</a>. Conductor: "+objeto["ConductorM"]+". Territorio: "+objeto["TerritorioM"]+"."};
							};
							if (vueltam===2) {
								salidam2=objeto["PuntoEncuentroM"];
								territoriom2=objeto["TerritorioM"];
								tiposalidam2=objeto["SalidaM"];
								horam2=objeto[clave];
								if (salidam2==="Zoom") {detallessalidasm=detallessalidasm+"<br>La salida por la mañana será a las "+objeto[clave]+" "+objeto["SalidaM"]+" por "+salidam2+". Conductor: "+objeto["ConductorM"]+". Territorio: "+objeto["TerritorioM"]+"."}
								else {presencial="si";detallessalidasm=detallessalidasm+"<br>La salida por la mañana será a las "+objeto[clave]+" "+objeto["SalidaM"]+" desde <a href='#' onclick='PuntoEncuentro(salidam2,territoriom2,fechita,horam2,tiposalidam2)'>"+salidam2+"</a>. Conductor: "+objeto["ConductorM"]+". Territorio: "+objeto["TerritorioM"]+"."};
							};
							if (vueltam===3) {
								salidam3=objeto["PuntoEncuentroM"];
								territoriom3=objeto["TerritorioM"];
								tiposalidam3=objeto["SalidaM"];
								horam3=objeto[clave];
								if (salidam3==="Zoom") {detallessalidasm=detallessalidasm+"<br>La salida por la mañana será a las "+objeto[clave]+" "+objeto["SalidaM"]+" por "+salidam3+". Conductor: "+objeto["ConductorM"]+". Territorio: "+objeto["TerritorioM"]+"."}
								else {presencial="si";detallessalidasm=detallessalidasm+"<br>La salida por la mañana será a las "+objeto[clave]+" "+objeto["SalidaM"]+" desde <a href='#' onclick='PuntoEncuentro(salidam3,territoriom3,fechita,horam3,tiposalidam3)'>"+salidam3+"</a>. Conductor: "+objeto["ConductorM"]+". Territorio: "+objeto["TerritorioM"]+"."};
							};
							if (vueltam===4) {
								salidam4=objeto["PuntoEncuentroM"];
								territoriom4=objeto["TerritorioM"];
								tiposalidam4=objeto["SalidaM"];
								horam4=objeto[clave];
								if (salidam4==="Zoom") {detallessalidasm=detallessalidasm+"<br>La salida por la mañana será a las "+objeto[clave]+" "+objeto["SalidaM"]+" por "+salidam4+". Conductor: "+objeto["ConductorM"]+". Territorio: "+objeto["TerritorioM"]+"."}
								else {presencial="si";detallessalidasm=detallessalidasm+"<br>La salida por la mañana será a las "+objeto[clave]+" "+objeto["SalidaM"]+" desde <a href='#' onclick='PuntoEncuentro(salidam4,territoriom4,fechita,horam4,tiposalidam4)'>"+salidam4+"</a>. Conductor: "+objeto["ConductorM"]+". Territorio: "+objeto["TerritorioM"]+"."};
							};
							if (vueltam===5) {
								salidam5=objeto["PuntoEncuentroM"];
								territoriom5=objeto["TerritorioM"];
								tiposalidam5=objeto["SalidaM"];
								horam5=objeto[clave];
								if (salidam5==="Zoom") {detallessalidasm=detallessalidasm+"<br>La salida por la mañana será a las "+objeto[clave]+" "+objeto["SalidaM"]+" por "+salidam5+". Conductor: "+objeto["ConductorM"]+". Territorio: "+objeto["TerritorioM"]+"."}
								else {presencial="si";detallessalidasm=detallessalidasm+"<br>La salida por la mañana será a las "+objeto[clave]+" "+objeto["SalidaM"]+" desde <a href='#' onclick='PuntoEncuentro(salidam5,territoriom5,fechita,horam5,tiposalidam5)'>"+salidam5+"</a>. Conductor: "+objeto["ConductorM"]+". Territorio: "+objeto["TerritorioM"]+"."};
							};
						};
						if (clave==="HoraT" && objeto[clave] !=="") {
							vueltat=vueltat+1;
							if (vueltat===1) {
								salidat1=objeto["PuntoEncuentroT"];
								territoriot1=objeto["TerritorioT"];
								tiposalidat1=objeto["SalidaT"];
								horat1=objeto[clave];
								if (salidat1==="Zoom") {detallessalidast=detallessalidast+"La salida por la tarde será a las "+objeto[clave]+" "+objeto["SalidaT"]+" por "+salidat1+". Conductor: "+objeto["ConductorT"]+". Territorio: "+objeto["TerritorioT"]+"."}
								else {presencial="si";detallessalidast=detallessalidast+"La salida por la tarde será a las "+objeto[clave]+" "+objeto["SalidaT"]+" desde <a href='#' onclick='PuntoEncuentro(salidat1,territoriot1,fechita,horat1,tiposalidat1)'>"+salidat1+"</a>. Conductor: "+objeto["ConductorT"]+". Territorio: "+objeto["TerritorioT"]+"."};
							};
							if (vueltat===2) {
								salidat2=objeto["PuntoEncuentroT"];
								territoriot2=objeto["TerritorioT"];
								tiposalidat2=objeto["SalidaT"];
								horat2=objeto[clave];
								if (salidat2==="Zoom") {detallessalidast=detallessalidast+"<br>La salida por la tarde será a las "+objeto[clave]+" "+objeto["SalidaT"]+" por "+salidat2+". Conductor: "+objeto["ConductorT"]+". Territorio: "+objeto["TerritorioT"]+"."}
								else {presencial="si";detallessalidast=detallessalidast+"<br>La salida por la tarde será a las "+objeto[clave]+" "+objeto["SalidaT"]+" desde <a href='#' onclick='PuntoEncuentro(salidat2,territoriot2,fechita,horat2,tiposalidat2)'>"+salidat2+"</a>. Conductor: "+objeto["ConductorT"]+". Territorio: "+objeto["TerritorioT"]+"."};
							};
							if (vueltat===3) {
								salidat3=objeto["PuntoEncuentroT"];
								territoriot3=objeto["TerritorioT"];
								tiposalidat3=objeto["SalidaT"];
								horat3=objeto[clave];
								if (salidat3==="Zoom") {detallessalidast=detallessalidast+"<br>La salida por la tarde será a las "+objeto[clave]+" "+objeto["SalidaT"]+" por "+salidat3+". Conductor: "+objeto["ConductorT"]+". Territorio: "+objeto["TerritorioT"]+"."}
								else {presencial="si";detallessalidast=detallessalidast+"<br>La salida por la tarde será a las "+objeto[clave]+" "+objeto["SalidaT"]+" desde <a href='#' onclick='PuntoEncuentro(salidat3,territoriot3,fechita,horat3,tiposalidat3)'>"+salidat3+"</a>. Conductor: "+objeto["ConductorT"]+". Territorio: "+objeto["TerritorioT"]+"."};
							};
							if (vueltat===4) {
								salidat4=objeto["PuntoEncuentroT"];
								territoriot4=objeto["TerritorioT"];
								tiposalidat4=objeto["SalidaT"];
								horat4=objeto[clave];
								if (salidat4==="Zoom") {detallessalidast=detallessalidast+"<br>La salida por la tarde será a las "+objeto[clave]+" "+objeto["SalidaT"]+" por "+salidat4+". Conductor: "+objeto["ConductorT"]+". Territorio: "+objeto["TerritorioT"]+"."}
								else {presencial="si";detallessalidast=detallessalidast+"<br>La salida por la tarde será a las "+objeto[clave]+" "+objeto["SalidaT"]+" desde <a href='#' onclick='PuntoEncuentro(salidat4,territoriot4,fechita,horat4,tiposalidat4)'>"+salidat4+"</a>. Conductor: "+objeto["ConductorT"]+". Territorio: "+objeto["TerritorioT"]+"."};
							};
							if (vueltat===5) {
								salidat5=objeto["PuntoEncuentroT"];
								territoriot5=objeto["TerritorioT"];
								tiposalidat5=objeto["SalidaT"];
								horat5=objeto[clave];
								if (salidat5==="Zoom") {detallessalidast=detallessalidast+"<br>La salida por la tarde será a las "+objeto[clave]+" "+objeto["SalidaT"]+" por "+salidat5+". Conductor: "+objeto["ConductorT"]+". Territorio: "+objeto["TerritorioT"]+"."}
								else {presencial="si";detallessalidast=detallessalidast+"<br>La salida por la tarde será a las "+objeto[clave]+" "+objeto["SalidaT"]+" desde <a href='#' onclick='PuntoEncuentro(salidat5,territoriot5,fechita,horat5,tiposalidat5)'>"+salidat5+"</a>. Conductor: "+objeto["ConductorT"]+". Territorio: "+objeto["TerritorioT"]+"."};
							};
						};
						if (clave==="HoraN" && objeto[clave] !=="") {
							vueltan=vueltan+1;
							if (vueltan===1) {
								salidan1=objeto["PuntoEncuentroN"];
								territorion1=objeto["TerritorioN"];
								tiposalidan1=objeto["SalidaN"];
								horan1=objeto[clave];
								if (salidan1==="Zoom") {detallessalidasn=detallessalidasn+"La salida por la noche será a las "+objeto[clave]+" "+objeto["SalidaN"]+" por "+salidan1+". Conductor: "+objeto["ConductorN"]+". Territorio: "+objeto["TerritorioN"]+"."}
								else {presencial="si";detallessalidasn=detallessalidasn+"La salida por la noche será a las "+objeto[clave]+" "+objeto["SalidaN"]+" desde <a href='#' onclick='PuntoEncuentro(salidan1,territorion1,fechita,horan1,tiposalidan1)'>"+salidan1+"</a>. Conductor: "+objeto["ConductorN"]+". Territorio: "+objeto["TerritorioN"]+"."};
							};
							if (vueltan===2) {
								salidan2=objeto["PuntoEncuentroN"];
								territorion2=objeto["TerritorioN"];
								tiposalidan2=objeto["SalidaN"];
								horan2=objeto[clave];
								if (salidan2==="Zoom") {detallessalidasn=detallessalidasn+"<br>La salida por la noche será a las "+objeto[clave]+" "+objeto["SalidaN"]+" por "+salidan2+". Conductor: "+objeto["ConductorN"]+". Territorio: "+objeto["TerritorioN"]+"."}
								else {presencial="si";detallessalidasn=detallessalidasn+"<br>La salida por la noche será a las "+objeto[clave]+" "+objeto["SalidaN"]+" desde <a href='#' onclick='PuntoEncuentro(salidan2,territorion2,fechita,horan2,tiposalidan2)'>"+salidan2+"</a>. Conductor: "+objeto["ConductorN"]+". Territorio: "+objeto["TerritorioN"]+"."};
							};
							if (vueltan===3) {
								salidan3=objeto["PuntoEncuentroN"];
								territorion3=objeto["TerritorioN"];
								tiposalidan3=objeto["SalidaN"];
								horan3=objeto[clave];
								if (salidan3==="Zoom") {detallessalidasn=detallessalidasn+"<br>La salida por la noche será a las "+objeto[clave]+" "+objeto["SalidaN"]+" por "+salidan3+". Conductor: "+objeto["ConductorN"]+". Territorio: "+objeto["TerritorioN"]+"."}
								else {presencial="si";detallessalidasn=detallessalidasn+"<br>La salida por la noche será a las "+objeto[clave]+" "+objeto["SalidaN"]+" desde <a href='#' onclick='PuntoEncuentro(salidan3,territorion3,fechita,horan3,tiposalidan3)'>"+salidan3+"</a>. Conductor: "+objeto["ConductorN"]+". Territorio: "+objeto["TerritorioN"]+"."};
							};
							if (vueltan===4) {
								salidan4=objeto["PuntoEncuentroN"];
								territorion4=objeto["TerritorioN"];
								tiposalidan4=objeto["SalidaN"];
								horan4=objeto[clave];
								if (salidan4==="Zoom") {detallessalidasn=detallessalidasn+"<br>La salida por la noche será a las "+objeto[clave]+" "+objeto["SalidaN"]+" por "+salidan4+". Conductor: "+objeto["ConductorN"]+". Territorio: "+objeto["TerritorioN"]+"."}
								else {presencial="si";detallessalidasn=detallessalidasn+"<br>La salida por la noche será a las "+objeto[clave]+" "+objeto["SalidaN"]+" desde <a href='#' onclick='PuntoEncuentro(salidan4,territorion4,fechita,horan4,tiposalidan4)'>"+salidan4+"</a>. Conductor: "+objeto["ConductorN"]+". Territorio: "+objeto["TerritorioN"]+"."};
							};
							if (vueltan===5) {
								salidan5=objeto["PuntoEncuentroN"];
								territorion5=objeto["TerritorioN"];
								tiposalidan5=objeto["SalidaN"];
								horan5=objeto[clave];
								if (salidan5==="Zoom") {detallessalidasn=detallessalidasn+"<br>La salida por la noche será a las "+objeto[clave]+" "+objeto["SalidaN"]+" por "+salidan5+". Conductor: "+objeto["ConductorN"]+". Territorio: "+objeto["TerritorioN"]+"."}
								else {presencial="si";detallessalidasn=detallessalidasn+"<br>La salida por la noche será a las "+objeto[clave]+" "+objeto["SalidaN"]+" desde <a href='#' onclick='PuntoEncuentro(salidan5,territorion5,fechita,horan5,tiposalidan5)'>"+salidan5+"</a>. Conductor: "+objeto["ConductorN"]+". Territorio: "+objeto["TerritorioN"]+"."};
							};
						};
					};
				});
			};
			
			if (detallessalidasm) {detallessalidas=detallessalidasm};
			if (detallessalidast && detallessalidas) {detallessalidas=detallessalidas+"<br>"+detallessalidast};
			if (detallessalidast && !detallessalidas) {detallessalidas=detallessalidast};
			if (detallessalidasn && detallessalidas) {detallessalidas=detallessalidas+"<br>"+detallessalidasn};
			if (detallessalidasn && !detallessalidas) {detallessalidas=detallessalidasn};
			if (detallessalidas && presencial==="si") {detallessalidas=detallessalidas+"<br><br>En el caso de las salidas de casa en casa, toca el lugar de encuentro (lo veras resaltado en color) para verlo en el mapa junto con el territorio a predicar.-"};
			if (!detallessalidas) {detallessalidas="Ese día no hay salidas programadas.-"};
			document.getElementById("DetallesSalidas").innerHTML=detallessalidas;
			document.getElementById("titulo-modalsal").innerText=fecha;
		};
		
		function PuntoEncuentro(puntosalida,territorioapredicar,fecha,hora,tiposalida) {
			CerrarModalCalendario('modal1');
			CerrarModalCalendario('modal2');
			if (capa_territoriofiltrado) mapa.removeLayer(capa_territoriofiltrado);
			let resultado = puntosencuentro.find(p => p.Lugar === puntosalida);
			coordsalida=resultado.Coordenadas.split(",");
			var coord=[];
			coord.push(coordsalida[0],coordsalida[1]);
			if (marcapuntosalida) {marcapuntosalida.remove()};
			marcapuntosalida=L.marker(coord,{icon:L.icon({iconUrl: 'images/predicando.jpg',iconSize: [50, 55],iconAnchor: [16, 37],popupAnchor: [0, -28]}),title:""+fecha+" a las "+hora+" "+tiposalida+": "+puntosalida+". Territorio: "+territorioapredicar})
					.bindPopup(""+fecha+" a las "+hora+" "+tiposalida+": "+puntosalida+". Territorio: "+territorioapredicar)
					.openPopup().addTo(mapa);
			mapa.flyTo(coord,16);
			puntomascercano=[];
			let coordlat= Number(coordsalida[0]);
			let coordlon= Number(coordsalida[1]);
			puntomascercano.push(coordlat,coordlon);
			if (typeof territorioapredicar === "number" && !isNaN(territorioapredicar)) {
				TerritorioAbuscar(territorioapredicar,"salida");
			} else {
				if (territorioapredicar.includes("y") || territorioapredicar.includes(",") || territorioapredicar.includes(";") || territorioapredicar.includes("-") || territorioapredicar.includes(" ")) {
					if (capa_coloresterritorios) {mapa.removeLayer(capa_coloresterritorios)};
					if (capa_numerosterritorios) {mapa.removeLayer(capa_numerosterritorios)};
					if (capa_infoterritorios) {mapa.removeLayer(capa_infoterritorios)};
					if (nada) {mapa.removeLayer(nada)};
					if (capa_territoriofiltrado) {mapa.removeLayer(capa_territoriofiltrado)};
					if (capa_territoriofiltradonumero) {mapa.removeLayer(capa_territoriofiltradonumero)};
					if (numeroterritorio) {mapa.removeLayer(numeroterritorio)};
					if (marcapuntosalida && ! cartografiar==="salida") {marcapuntosalida.remove()};
					if (capa_casas) {mapa.removeLayer(capa_casas)};
					if (casa) {casa.remove()};
					if (casitas) {casitas.remove()};
					if (ruta) {ruta.remove()};
					cartografiar="salida";
					FiltrarVariosTerritorios(territorioapredicar);
					if (capa_infoterritorios) {capa_infoterritorios.addTo(mapa)};
					//capa_territoriofiltradonumero=L.geoJSON(territorios,{filter:FiltrarVariosTerritoriosNumero, onEachFeature: NumeroTerritorio}).addTo(mapa);
					if (seguimiento==="si") {
						titulomodalflash.innerText="TRAZAR RUTA";
						cuerpomodalflash.innerHTML = '<span style="color:green"><br><b>¿Necesitás ayuda para llegar?.</b><br><br><span style="color:black">Puedo trazarte una ruta '+
						'a partir de tu ubicación actual y brindarte algunas indicaciones.-<br></span>';
						document.getElementById("btn-indicaciones-modal-flash").style.visibility='visible';
						tiempomodalflash=5000;
						ModalFlash(tiempomodalflash);
					};
				};
			};
		};
		
		function FiltrarVariosTerritorios(num_terr) {
			const idSet = AnalizarCadenaVariosTerritorios(num_terr);
			capa_territoriofiltrado = L.geoJSON(territorios, {
				filter: f => ConjuntoCoincidencias(f, idSet),
				style: f => ConjuntoCoincidencias(f, idSet) ? highlightStyle : defaultStyle,
				onEachFeature: (f, layer) => {
					layer.bindPopup(`Numero: ${f.properties.Numero}<br>`);
				}
			}).addTo(mapa);
			if (capa_territoriofiltradonumero) {mapa.removeLayer(capa_territoriofiltradonumero)};
			capa_territoriofiltradonumero = L.geoJSON(territorios, {
				filter: f => ConjuntoCoincidencias(f, idSet),
				onEachFeature: NumeroTerritorio
			}).addTo(mapa);
		};
		
		// --- Parser que soporta rangos ---
		function AnalizarCadenaVariosTerritorios(str) {
			const result = new Set();
			if (!str) return result;
			str.split(',').forEach(part => {
				const token = part.trim();
				if (!token) return;
				// Si es rango "x-y"
				if (/^\d+\s*-\s*\d+$/.test(token)) {
				let [start, end] = token.split('-').map(s => Number(s.trim()));
				if (!isNaN(start) && !isNaN(end)) {
					if (start > end) [start, end] = [end, start]; // soporta "7-3"
					for (let i = start; i <= end; i++) result.add(i);
				}
				} else {
					// Número suelto
					const n = Number(token);
					if (!isNaN(n)) result.add(n);
				}
			});
			return result;
		};
		const defaultStyle = {fillColor: "#020259",	weight: 4, opacity: 1, color: "#46fafa", dashArray: '3', fillOpacity: 0.3};
		const highlightStyle = {color: '#020259', weight: 2, fillOpacity: 0.35};
		function ConjuntoCoincidencias(feature, idSet, propName = 'Numero') {
			if (!feature || !feature.properties) return false;
			return idSet.has(feature.properties[propName]);
		};
		
		<!--Función para enviar reporte de lo que se abarcó en cada salida-->
		function ReportarPredicado() {
			document.getElementById("ModalReportePredicado").style.visibility='visible';
		};
		
		<!--Función para cerrar el modal del reporte de lo predicado-->
		function CerrarModalReporte () {
			document.getElementById("ModalReportePredicado").style.visibility='hidden';
			document.getElementById("manzanaspredicadas").style.visibility='hidden';
			document.getElementById("leyendamanzanaspredicadas").style.visibility='hidden';
			clearTimeout(temporizadorpredicado);
		};
		
		<!--Función para revisar y enviar el reporte de lo predicado-->
		document.getElementById('btn-enviar-reporte').addEventListener('click', async () => {
			const enviando = document.getElementById('enviandoreporte');
			if (document.getElementById('nombrepredicado').value==="" || document.getElementById('territoriopredicado').value==="" || document.getElementById('fechapredicado').value===""
			|| (!todopred.checked && !partepred.checked) || (partepred.checked && document.getElementById('abarcadopredicado').value==="")) {
				if (document.getElementById('fechapredicado').value==="") {document.getElementById("fechapredicado").placeholder = "Por favor, ingresá alguna fecha aquí...";document.getElementById("fechapredicado").focus()};
				if (document.getElementById('nombrepredicado').value==="") {document.getElementById("nombrepredicado").placeholder = "Por favor, ingresá tu nombre aquí...";document.getElementById("nombrepredicado").focus()};
				if (document.getElementById('territoriopredicado').value==="") {document.getElementById("territoriopredicado").placeholder = "Por favor, ingresá el número del territorio aquí...";document.getElementById("territoriopredicado").focus()};
				if (document.getElementById('abarcadopredicado').value==="") {document.getElementById("abarcadopredicado").placeholder = "Por favor, ingresá algún dato aquí...";document.getElementById("abarcadopredicado").focus()};
				enviando.textContent = 'Por favor, revisá que falta algún dato...';
			} else {
				enviando.textContent = 'Enviando la información...';
				const fd = new FormData();
				fd.append('fecha', document.getElementById('fechapredicado').value);
				fd.append('nombre', document.getElementById('nombrepredicado').value);
				fd.append('territorio', document.getElementById('territoriopredicado').value);
				if (todopred.checked) {fd.append('abarcado', "Completo")};
				if (partepred.checked) {fd.append('abarcado', document.getElementById('abarcadopredicado').value)};
				try {
					const res = await fetch(url_script_territorios, { method: 'POST', body: fd });
					const text = await res.text();
					enviando.textContent = 'HTTP ' + res.status + '\\n' + text;
					try {enviando.textContent ="Información enviada. Muchas gracias....!!!";
						temporizadorpredicado=setTimeout(() => {
							document.getElementById('nombrepredicado').value="";document.getElementById('fechapredicado').value="";
							document.getElementById('territoriopredicado').value="";document.getElementById('abarcadopredicado').value="";
							enviando.textContent ="";CerrarModalReporte()
							}
						, 5000)}
					catch(e){};
				} catch (err) {
					enviando.textContent = 'Hubo un error; por lo que no se pudo enviar la información. Por favor, intentalo nuevamente.-';
				};
			};
		});
		
		<!--Función para revisar si se predicó total o parcialmente el territorio en una salida-->
		var todopred=document.getElementById("todopredicado");
		var partepred=document.getElementById("algopredicado");
		todopred.addEventListener('change', () => {
			if (todopred.checked) {
				document.getElementById("manzanaspredicadas").style.visibility='hidden';
				document.getElementById("leyendamanzanaspredicadas").style.visibility='hidden';
				partepred.checked = false;
			};
		});
		partepred.addEventListener('change', () => {
			if (partepred.checked) {
				document.getElementById("manzanaspredicadas").style.visibility='visible';
				document.getElementById("leyendamanzanaspredicadas").style.visibility='visible';
				todopred.checked = false;
				document.getElementById("abarcadopredicado").focus();
			};
		});
		
		<!--Función para enviar reporte de una nueva casa NO VISITAR-->
		function ReportarNoVisitar() {
			document.getElementById("ModalReporteNoVisitar").style.visibility='visible';
		};
		
		<!--Función para cerrar el modal del reporte de NO VISITAR-->
		function CerrarModalNoVisitar () {
			document.getElementById("ModalReporteNoVisitar").style.visibility='hidden';
			document.getElementById("motivonovisitar").style.visibility='hidden';
			document.getElementById("detallemotivonovisitar").style.visibility='hidden';
			document.getElementById("leyendadetallemotivonovisitar").style.visibility='hidden';
			clearTimeout(temporizadornovisitar);
		};
		
		<!--Función para revisar y enviar el reporte de NO VISITAR-->
		document.getElementById('btn-enviar-reportenovisitar').addEventListener('click', async () => {
			const enviando = document.getElementById('enviandoreportenovisitar');
			if (document.getElementById('nombrenovisitar').value==="" || document.getElementById('territorionovisitar').value==="" || document.getElementById('fechanovisitar').value==="" || document.getElementById('direccionnovisitar').value===""
			|| (!expresonovisitar.checked && !noexpresonovisitar.checked) || (noexpresonovisitar.checked && document.getElementById('detallemotivonovisitar').value==="")) {
				if (document.getElementById('fechanovisitar').value==="") {document.getElementById("fechanovisitar").placeholder = "Por favor, ingresá alguna fecha aquí...";document.getElementById("fechanovisitar").focus()};
				if (document.getElementById('nombrenovisitar').value==="") {document.getElementById("nombrenovisitar").placeholder = "Por favor, ingresá tu nombre aquí...";document.getElementById("nombrenovisitar").focus()};
				if (document.getElementById('direccionnovisitar').value==="") {document.getElementById("direccionnovisitar").placeholder = "Por favor, ingresá la dirección de la casa aquí...";document.getElementById("direccionnovisitar").focus()};
				if (document.getElementById('territorionovisitar').value==="") {document.getElementById("territorionovisitar").placeholder = "Por favor, ingresá el número del territorio aquí...";document.getElementById("territorionovisitar").focus()};
				if (document.getElementById('detallemotivonovisitar').value==="") {document.getElementById("detallemotivonovisitar").placeholder = "Por favor, ingresá algún dato aquí...";document.getElementById("detallemotivonovisitar").focus()};
				enviando.textContent = 'Por favor, revisá que falta algún dato...';
			} else {
				enviando.textContent = 'Enviando la información...';
				const fd = new FormData();
				fd.append('fecha', document.getElementById('fechanovisitar').value);
				fd.append('direccion', document.getElementById('direccionnovisitar').value);
				fd.append('territorio', document.getElementById('territorionovisitar').value);
				if (expresonovisitar.checked) {fd.append('detalle', "Me lo dijo expresamente.")};
				if (noexpresonovisitar.checked) {fd.append('detalle', document.getElementById('detallemotivonovisitar').value)};
				fd.append('nombre', document.getElementById('nombrenovisitar').value);
				try {
					const res = await fetch(url_script_novisitar, { method: 'POST', body: fd });
					const text = await res.text();
					enviando.textContent = 'HTTP ' + res.status + '\\n' + text;
					try {enviando.textContent ="Información enviada. Muchas gracias....!!!";
						temporizadornovisitar=setTimeout(() => {
							document.getElementById('nombrenovisitar').value="";document.getElementById('fechanovisitar').value="";
							document.getElementById('territorionovisitar').value="";document.getElementById('detallemotivonovisitar').value="";document.getElementById('direccionnovisitar').value="";
							enviando.textContent ="";CerrarModalNoVisitar()
							}
						, 5000)}
					catch(e){};
				} catch (err) {
					enviando.textContent = 'Hubo un error; por lo que no se pudo enviar la información. Por favor, intentalo nuevamente.-';
				};
			};
		});
		
		<!--Función para revisar si la persona dijo expresamente que NO LA VOLVIERAMOS A VISITAR-->
		var expresonovisitar=document.getElementById("expresonovisitar");
		var noexpresonovisitar=document.getElementById("noexpresonovisitar");
		expresonovisitar.addEventListener('change', () => {
			if (expresonovisitar.checked) {
				document.getElementById("motivonovisitar").style.visibility='hidden';
				document.getElementById("leyendadetallemotivonovisitar").style.visibility='hidden';
				document.getElementById("detallemotivonovisitar").style.visibility='hidden';
				noexpresonovisitar.checked = false;
			};
		});
		noexpresonovisitar.addEventListener('change', () => {
			if (noexpresonovisitar.checked) {
				document.getElementById("motivonovisitar").style.visibility='visible';
				document.getElementById("leyendadetallemotivonovisitar").style.visibility='visible';
				document.getElementById("detallemotivonovisitar").style.visibility='visible';
				expresonovisitar.checked = false;
				document.getElementById("detallemotivonovisitar").focus();
			};
		});
		
		// Función que controla la vista de las manzanas según el Zoom
		function ActualizarVistaManzanas() {
			const z = mapa.getZoom();
			if (z >= 17) { 
				// Mostrar detalles en zoom alto
				if (!mapa.hasLayer(grupomanzanas)) {
				mapa.addLayer(grupomanzanas);
				}
			} else {
				// Ocultar detalles si se aleja
				if (mapa.hasLayer(grupomanzanas)) {
					mapa.removeLayer(grupomanzanas);
				}
			}
		};
		// Ejecutar cada vez que cambie el zoom
		mapa.on("zoomend", ActualizarVistaManzanas);
		
		//Bloque para resaltar o remarcar lo nuevo
		const elementonovedoso = document.getElementById('botonreportarnovisitar');
		//const modalnovedoso = document.getElementById('modalnovedoso');
		// Fechas de inicio y fin para resaltar o remarcar una novedad (pueden incluir hora si querés)
		const inicio = new Date("2025-10-15");
		const fin = new Date("2025-10-28");
		const hoy = new Date();
		const guia = document.getElementById('guia');
		//const kapa = document.getElementById('capa');
		if (hoy >= inicio && hoy <= fin) {
			//console.log("Estamos dentro del plazo para mostrar la novedad...!!!.-");
			elementonovedoso.classList.add('resaltarlonovedoso');
			abrirguia();
			const tiempo = setTimeout(() => {
				elementonovedoso.classList.remove('resaltarlonovedoso');
				cerrarguia();
			}, 12000);
		};
		
		//Bloque para LO NUEVO
		function abrirguia(){
			guia.style.display = 'block';
			//kapa.classList.add('active');
			// posicionar la guía apuntando al botón
			posicionguia();
			// animación de aparición
			requestAnimationFrame(()=> guia.classList.add('show'));
			// accesibilidad
			//guia.setAttribute('tabindex','-1');
			//guia.focus();
		};

		function cerrarguia(){
			guia.classList.remove('show');
			//kapa.classList.remove('active');
			// después de la transición, ocultamos
			setTimeout(()=> guia.style.display = 'none', 160);
		};

		function posicionguia(){
			const btnRect = elementonovedoso.getBoundingClientRect();
			const gRect = guia.getBoundingClientRect();
			const margin = 10; // separación mínima

			// ancho disponible y cálculo base
			const viewportW = document.documentElement.clientWidth;
			const viewportH = document.documentElement.clientHeight;

			// calculamos left centrado respecto al botón
			let left = btnRect.left + (btnRect.width/2) - (gRect.width/2);
			// recortamos para que no se salga de la pantalla
			left = Math.max(8, Math.min(left, viewportW - gRect.width - 8));

			// por defecto situamos arriba del botón
			let top = btnRect.top - gRect.height - margin;
			guia.classList.remove('bottom');

			// si no cabe arriba, lo ponemos abajo
			if(top < 8){
			top = btnRect.bottom + margin;
			guia.classList.add('bottom');
			}

			guia.style.left = left + 'px';
			guia.style.top = top + 'px';

			// posicionamos la flecha horizontalmente para que apunte al centro del botón
			// calculamos la diferencia entre el centro del modal y el centro del botón
			const modalCenterX = left + gRect.width/2;
			const btnCenterX = btnRect.left + btnRect.width/2;
			// queremos que --arrow-x sea la mitad de la flecha (negativa) + offset para centrar
			const arrowOffset = btnCenterX - modalCenterX;
			// la pseudo-element tiene left:50% y margin-left: calc(var(--arrow-x, -7px))
			// así que ponemos --arrow-x en px
			guia.style.setProperty('--arrow-x', (arrowOffset - 7) + 'px');
		};

		// reposicionar si hay resize o scroll
		window.addEventListener('resize', ()=>{
			if(guia.style.display !== 'none') posicionguia();
		});
		window.addEventListener('scroll', ()=>{
			if(guia.style.display !== 'none') posicionguia();
		}, {passive:true});

		// cerrar al hacer click fuera (capa) o dentro (guia)
		//kapa.addEventListener('click', cerrarguia);
		//guia.addEventListener('click', cerrarguia);

		// tambien cerrar con escape
		document.addEventListener('keydown', (e)=>{
			if(e.key === 'Escape') cerrarguia();
		});

		//Función para volver a mostrar los modales o mensajes cancelados por el usuario
		function RestablecerNoMostrar() {
			let inicial = Version;
			let numer = Number(inicial);
			let numero=numer-1;
			localStorage.setItem('MOSTRAR_INICIAL', numero);
			localStorage.setItem('MOSTRAR_CELULAR', "si");
			barralateral.close();
			document.getElementById("restablecernomostrar").style.visibility="hidden";
		};
		
		//Función No Volver a mostrar sugerencia para girar el celular
		function VerificarNoVolverAMostrar(){
			if (Version !== localStorage.getItem('MOSTRAR_INICIAL')) {ModalFlash(tiempomodalflash);document.getElementById("restablecernomostrar").style.visibility="hidden"} else {document.getElementById("borrableinicial").style.visibility="hidden";document.getElementById("restablecernomostrar").style.visibility="visible"};
			if (localStorage.getItem('MOSTRAR_CELULAR') !=="no" && sistema_operativo !=="Windows" && sistema_operativo !=="Linux") {modalinicial.showModal();document.getElementById("restablecernomostrar").style.visibility="hidden"} else {document.getElementById("borrablecelular").style.visibility="hidden";document.getElementById("restablecernomostrar").style.visibility="visible"};
		};
		
		//Activar/Desactivar/Mostrar/Ocultar/Ejecutar lo que corresponda al iniciar
		document.getElementById("btn-indicaciones-modal-flash").style.visibility='hidden';
		document.getElementById("distancia").style.visibility='hidden';
		document.getElementById("botoncentrado").style.visibility='hidden';
		document.getElementById("botonnorte").style.visibility='hidden';
		document.getElementById("ModalReportePredicado").style.visibility='hidden';
		document.getElementById("manzanaspredicadas").style.visibility='hidden';
		document.getElementById("leyendamanzanaspredicadas").style.visibility='hidden';
		document.getElementById("ModalReporteNoVisitar").style.visibility='hidden';
		document.getElementById("motivonovisitar").style.visibility='hidden';
		document.getElementById("detallemotivonovisitar").style.visibility='hidden';
		document.getElementById("leyendadetallemotivonovisitar").style.visibility='hidden';
		document.getElementById("botoncentrado").style.visibility='hidden';
		document.getElementById("MiModalFlash").style.visibility='hidden';
		const nomostrarinicial = document.getElementById('nomostrarinicial');
		const nomostrarcelular = document.getElementById('nomostrarcelular');
		var Version = "1"; //Cambiar este valor para volver a mostrar el modal de presentacion
		VerificarConexion();
		VerificarVersion();
		VerificarSistemaOperativo();
		VerificarNoVolverAMostrar();
	</script>
</html>